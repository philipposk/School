<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A professional online learning platform offering master's-level courses in critical thinking, logic, finance, and software development.">
    <!-- Updated: 2025-01-06 -->
    <title>School - Enhanced Learning Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <link rel="stylesheet" href="css/enhanced-styles.css">
    <link rel="stylesheet" href="css/messaging-assignments.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" onerror="console.warn('Three.js failed to load, 3D effects disabled')"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        :root {
            --primary: #2d3748;
            --secondary: #667eea;
            --accent: #764ba2;
            --success: #48bb78;
            --warning: #ed8936;
            --error: #f56565;
        }

        /* Light Mode */
        :root, [data-theme="light"] {
            --bg: #f7fafc;
            --card: #ffffff;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --hover-bg: #f7fafc;
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --bg: #1a202c;
            --card: #2d3748;
            --text: #e2e8f0;
            --text-light: #a0aec0;
            --border: #4a5568;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5);
            --hover-bg: #374151;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
            overflow-x: hidden;
            transition: background 0.3s, color 0.3s;
            perspective: 1000px;
            perspective-origin: center center;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            transform-style: preserve-3d;
            backface-visibility: hidden;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.25rem;
            transition: background 0.2s;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.125rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .user-email {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--card);
            color: var(--text);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            display: none;
            z-index: 1001;
            border: 1px solid var(--border);
        }

        .profile-dropdown.show {
            display: block;
        }

        .profile-dropdown-item {
            padding: 1rem;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid var(--border);
        }

        .profile-dropdown-item:last-child {
            border-bottom: none;
        }

        .profile-dropdown-item:hover {
            background: var(--hover-bg);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--card);
            color: var(--text);
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            z-index: 2001;
        }
        
        /* Prevent modal content clicks from closing modal */
        .modal-content {
            pointer-events: auto;
        }
        
        .modal {
            cursor: pointer; /* Show pointer on backdrop */
        }
        
        .modal .modal-content {
            cursor: default; /* Default cursor on content */
        }

        /* Split-screen modal for assignment submission */
        .modal-content.split-view {
            max-width: 95%;
            width: 95%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            padding: 0;
            overflow: hidden;
        }

        .modal-content.split-view .modal-left-panel,
        .modal-content.split-view .modal-right-panel {
            overflow-y: auto;
            max-height: 90vh;
            padding: 1.5rem;
        }

        .modal-content.split-view .modal-left-panel {
            background: var(--bg);
            border-right: 1px solid var(--border);
        }

        .modal-content.split-view .modal-right-panel {
            background: var(--card);
        }

        @media (max-width: 768px) {
            .modal-content.split-view {
                grid-template-columns: 1fr;
                max-width: 100%;
                width: 100%;
            }
            
            .modal-content.split-view .modal-left-panel {
                display: none;
            }
            
            .modal-content.split-view .modal-right-panel {
                max-height: 100vh;
            }
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        /* Easter egg animations */
        @keyframes modal3DOpen {
            0% {
                transform: perspective(1000px) rotateX(90deg) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: perspective(1000px) rotateX(45deg) scale(0.8);
                opacity: 0.7;
            }
            100% {
                transform: perspective(1000px) rotateX(0deg) scale(1);
                opacity: 1;
            }
        }

        @keyframes modal3DClose {
            0% {
                transform: perspective(1000px) rotateX(0deg) scale(1);
                opacity: 1;
            }
            100% {
                transform: perspective(1000px) rotateX(-90deg) scale(0.3);
                opacity: 0;
            }
        }

        @keyframes characterBounce {
            0%, 100% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-20px) scale(1.1);
            }
        }

        @keyframes characterShake {
            0%, 100% {
                transform: rotate(0deg);
            }
            25% {
                transform: rotate(-10deg);
            }
            75% {
                transform: rotate(10deg);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .easter-egg-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .easter-egg-gif-container {
            margin-bottom: 2rem;
            max-width: 400px;
            max-height: 400px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .easter-egg-gif-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .easter-egg-3d-modal {
            background: var(--card);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            animation: modal3DOpen 0.8s ease-out forwards;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .easter-egg-3d-modal.closing {
            animation: modal3DClose 0.5s ease-in forwards;
        }

        .easter-egg-character {
            text-align: center;
            margin-top: 2rem;
        }

        .easter-egg-character-emoji {
            font-size: 4rem;
            display: inline-block;
            animation: characterBounce 1s ease-in-out infinite, characterShake 0.5s ease-in-out 0.3s;
        }

        .easter-egg-message {
            margin-top: 1rem;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text);
            animation: fadeIn 0.5s ease-out 0.5s both;
        }

        .easter-egg-subtitle {
            margin-top: 0.5rem;
            font-size: 1rem;
            color: var(--text-light);
            animation: fadeIn 0.5s ease-out 0.7s both;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
            background: var(--bg);
            color: var(--text);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .btn {
            padding: 0.875rem 1.75rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 1rem;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--bg);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--hover-bg);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Course Listing Page */
        .courses-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
            transform-style: preserve-3d;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: var(--text-light);
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            perspective: 1200px;
            transform-style: preserve-3d;
        }

        .course-card {
            background: var(--card);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 1px solid var(--border);
            transform-style: preserve-3d;
            position: relative;
            will-change: transform;
        }

        .course-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }

        .course-card:hover {
            transform: translateY(-10px) translateZ(20px) rotateX(3deg) rotateY(-2deg);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .course-card:hover::before {
            opacity: 1;
        }

        .course-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .course-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .course-description {
            color: var(--text-light);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .course-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .course-stats {
            display: flex;
            justify-content: space-between;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            font-size: 0.875rem;
            color: var(--text-light);
        }

        /* Course View */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 2rem;
        }

        .sidebar {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: fit-content;
            max-height: calc(100vh - 120px);
            position: sticky;
            top: 100px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            flex-shrink: 0;
        }

        .course-title-sidebar {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text);
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .module-list {
            list-style: none;
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
            padding-right: 0.5rem;
            margin-right: -0.5rem;
        }

        /* Custom scrollbar for module list */
        .module-list::-webkit-scrollbar {
            width: 6px;
        }

        .module-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .module-list::-webkit-scrollbar-thumb {
            background: var(--text-light);
            border-radius: 3px;
        }

        .module-list::-webkit-scrollbar-thumb:hover {
            background: var(--text);
        }

        .module-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .module-item:hover {
            background: var(--hover-bg);
            transform: translateX(5px);
        }

        .module-item.active {
            background: var(--hover-bg);
            border-left-color: var(--secondary);
            font-weight: 600;
        }

        .sidebar-nav-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            color: var(--text);
        }

        .sidebar-nav-item:hover {
            background: var(--hover-bg);
            transform: translateX(5px);
        }

        .sidebar-nav-item.active {
            background: var(--hover-bg);
            border-left-color: var(--secondary);
            font-weight: 600;
        }

        .sidebar-nav-item-icon {
            font-size: 1.2rem;
        }

        .module-number {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
        }

        .module-name {
            font-size: 0.95rem;
            color: var(--text);
        }

        .module-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.75rem;
        }

        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .status-completed {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-in-progress {
            background: #feebc8;
            color: #7c2d12;
        }

        [data-theme="dark"] .status-completed {
            background: #22543d;
            color: #c6f6d5;
        }

        [data-theme="dark"] .status-in-progress {
            background: #7c2d12;
            color: #feebc8;
        }

        .content-area {
            background: var(--card);
            border-radius: 12px;
            padding: 3rem;
            box-shadow: var(--shadow);
            min-height: 600px;
            border: 1px solid var(--border);
        }

        .module-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }

        .module-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .module-subtitle {
            font-size: 1.125rem;
            color: var(--text-light);
        }

        .module-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .module-content {
            font-size: 1.0625rem;
            line-height: 1.8;
        }

        .module-content h1 {
            font-size: 2rem;
            margin: 2rem 0 1rem;
            color: var(--secondary);
            font-weight: 700;
        }

        .module-content h2 {
            font-size: 1.5rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--accent);
            font-weight: 600;
        }

        .module-content h3 {
            font-size: 1.25rem;
            margin: 1.25rem 0 0.5rem;
            color: var(--text);
            font-weight: 600;
        }

        .module-content h4 {
            font-size: 1.125rem;
            margin: 1rem 0 0.5rem;
            color: var(--text);
            font-weight: 600;
        }

        .module-content p {
            margin: 1rem 0;
        }

        .module-content ul, .module-content ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }

        .module-content li {
            margin: 0.5rem 0;
        }

        .module-content code {
            background: var(--hover-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.9em;
            color: var(--error);
        }

        .module-content pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.6;
        }

        /* Dark mode: brighter colors for ASCII art */
        [data-theme="dark"] .module-content pre {
            background: #0f172a;
            color: #f1f5f9;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Light mode: darker background for contrast */
        [data-theme="light"] .module-content pre {
            background: #f8fafc;
            color: #1e293b;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .module-content pre code {
            background: none;
            color: inherit;
            padding: 0;
            font-family: 'Courier New', Courier, monospace;
        }

        /* Special styling for ASCII art diagrams */
        .module-content pre code,
        .module-content pre {
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* Ensure ASCII characters are visible */
        [data-theme="dark"] .module-content pre,
        [data-theme="dark"] .module-content pre code {
            color: #e2e8f0;
            text-shadow: 0 0 1px rgba(255, 255, 255, 0.3);
        }

        .module-content blockquote {
            border-left: 4px solid var(--secondary);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            color: var(--text-light);
            font-style: italic;
        }

        .module-content strong {
            font-weight: 600;
            color: var(--text);
        }

        .resource-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--hover-bg);
            color: var(--secondary);
            border-radius: 8px;
            text-decoration: none;
            margin: 0.5rem 0.5rem 0.5rem 0;
            transition: all 0.2s;
            font-weight: 500;
        }

        .resource-link:hover {
            background: var(--secondary);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .quiz-container {
            background: var(--hover-bg);
            border: 2px solid var(--secondary);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .quiz-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary);
        }

        .quiz-question {
            background: var(--card);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 1.125rem;
            color: var(--text);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .quiz-option {
            padding: 1rem;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
        }

        .quiz-option:hover {
            border-color: var(--secondary);
            background: var(--hover-bg);
        }

        .quiz-option.selected {
            background: var(--hover-bg);
            border-color: var(--secondary);
        }

        .quiz-option.correct {
            background: #c6f6d5;
            border-color: var(--success);
        }

        .quiz-option.incorrect {
            background: #fed7d7;
            border-color: var(--error);
        }

        .quiz-explanation {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--card);
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
            display: none;
            color: var(--text);
        }

        .quiz-explanation.show {
            display: block;
        }

        .short-answer-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            margin-top: 0.5rem;
            background: var(--bg);
            color: var(--text);
        }

        .quiz-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .quiz-score {
            text-align: center;
            padding: 1.5rem;
            background: var(--card);
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .score-pass {
            color: var(--success);
        }

        .score-fail {
            color: var(--error);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border);
        }

        .loading {
            text-align: center;
            padding: 4rem;
            color: var(--text-light);
        }

        .spinner {
            border: 4px solid var(--border);
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: relative;
                top: 0;
            }

            .header-content {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 768px) {
            .container, .courses-container {
                padding: 1rem;
            }

            .content-area {
                padding: 1.5rem;
            }

            .module-title {
                font-size: 1.5rem;
            }

            .user-info {
                display: none;
            }

            .courses-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 3D Hero Section */
        .hero-section {
            min-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
        }

        [data-theme="dark"] .hero-section {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%);
            background-size: 200% 200%;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .hero-3d-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.3;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: white;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeInUp 1s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-title {
            font-size: clamp(2.5rem, 8vw, 5rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(255, 255, 255, 0.3);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .hero-subtitle {
            font-size: clamp(1.125rem, 3vw, 1.5rem);
            margin-bottom: 3rem;
            opacity: 0.95;
            font-weight: 300;
            letter-spacing: 0.5px;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .hero-cta {
            display: inline-flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            animation: fadeInUp 1s ease-out 0.4s both;
        }

        .hero-btn {
            padding: 1.25rem 2.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .hero-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .hero-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .hero-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.3);
        }

        .hero-btn-primary {
            background: rgba(255, 255, 255, 0.95);
            color: #667eea;
            border: 2px solid rgba(255, 255, 255, 0.95);
        }

        .hero-btn-primary:hover {
            background: white;
            box-shadow: 0 20px 40px rgba(255, 255, 255, 0.3);
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: floatShape 20s infinite ease-in-out;
        }

        .shape:nth-child(1) {
            width: 200px;
            height: 200px;
            background: white;
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 150px;
            height: 150px;
            background: white;
            border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
            top: 60%;
            right: 10%;
            animation-delay: 5s;
        }

        .shape:nth-child(3) {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            bottom: 20%;
            left: 20%;
            animation-delay: 10s;
        }

        @keyframes floatShape {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }
            33% {
                transform: translate(30px, -30px) rotate(120deg);
            }
            66% {
                transform: translate(-20px, 20px) rotate(240deg);
            }
        }

        /* Modern Course Cards */
        .modern-courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            padding: 4rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .modern-course-card {
            background: var(--card);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out both;
        }

        .modern-course-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .modern-course-card:hover::before {
            opacity: 1;
        }

        .modern-course-card:nth-child(1) { animation-delay: 0.1s; }
        .modern-course-card:nth-child(2) { animation-delay: 0.2s; }
        .modern-course-card:nth-child(3) { animation-delay: 0.3s; }

        .modern-course-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
        }

        .modern-course-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: inline-block;
            animation: bounceGentle 3s infinite;
        }

        @keyframes bounceGentle {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }

        .modern-course-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .modern-course-description {
            color: var(--text-light);
            margin-bottom: 1.5rem;
            line-height: 1.7;
        }

        .modern-course-meta {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .modern-course-arrow {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--secondary);
            font-weight: 600;
            transition: transform 0.3s;
        }

        .modern-course-card:hover .modern-course-arrow {
            transform: translateX(5px);
        }

        /* AI Chatbot Bubble - Always fixed bottom-right */
        .chatbot-bubble {
            position: fixed !important;
            bottom: 2rem !important;
            right: 2rem !important;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            z-index: 9999 !important;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: pulse 2s infinite;
        }

        .chatbot-bubble:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.6);
        }

        .chatbot-bubble.active {
            transform: scale(0.9);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4), 0 0 0 10px rgba(102, 126, 234, 0.1);
            }
        }

        .chatbot-icon {
            font-size: 2rem;
            color: white;
        }

        .chatbot-window {
            position: fixed !important;
            bottom: 100px !important;
            right: 2rem !important;
            width: 400px;
            max-width: calc(100vw - 4rem);
            height: 600px;
            max-height: calc(100vh - 120px);
            background: var(--card);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 9998 !important;
            display: none;
            flex-direction: column;
            border: 1px solid var(--border);
            overflow: hidden;
            animation: slideUpFade 0.3s ease-out;
        }

        .chatbot-window.show {
            display: flex;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .chatbot-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chatbot-header-title {
            font-weight: 600;
            font-size: 1.125rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chatbot-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .chatbot-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chatbot-message {
            display: flex;
            gap: 0.75rem;
            animation: fadeInUp 0.3s ease-out;
        }

        .chatbot-message.user {
            flex-direction: row-reverse;
        }

        .chatbot-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .chatbot-message .chatbot-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1.25rem;
        }

        .chatbot-message.user .chatbot-avatar {
            background: var(--hover-bg);
            color: var(--text);
        }

        .chatbot-text {
            background: var(--hover-bg);
            padding: 0.875rem 1.125rem;
            border-radius: 18px;
            max-width: 75%;
            color: var(--text);
            line-height: 1.5;
        }

        .chatbot-message.user .chatbot-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .chatbot-input-container {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.75rem;
        }

        .chatbot-input {
            flex: 1;
            padding: 0.875rem 1.125rem;
            border: 2px solid var(--border);
            border-radius: 24px;
            background: var(--bg);
            color: var(--text);
            font-size: 0.9375rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .chatbot-input:focus {
            border-color: var(--secondary);
        }

        .chatbot-send {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .chatbot-send:hover {
            transform: scale(1.1);
        }

        .chatbot-send:active {
            transform: scale(0.95);
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }

            .modern-courses-grid {
                grid-template-columns: 1fr;
                padding: 2rem 1rem;
            }

            .chatbot-window {
                width: calc(100vw - 2rem);
                height: calc(100vh - 100px);
                bottom: 80px;
                right: 1rem;
            }

            .chatbot-bubble {
                bottom: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Welcome to Learning Platform</h2>
                <p style="color: var(--text-light); margin-top: 0.5rem;">Sign in to track your progress</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email or Username</label>
                    <input type="text" class="form-input" id="loginEmail" placeholder="Enter your email or username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required autocomplete="current-password">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Sign In</button>
                </div>
                <p style="text-align: center; margin-top: 1rem; font-size: 0.875rem; color: var(--text-light);">
                    Don't have an account? <a href="#" onclick="event.preventDefault(); showSignUpForm();" style="color: var(--theme-primary);">Sign up</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Your Profile</h2>
            </div>
            <form id="profileForm">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="profileName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="profileEmail" required>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="closeProfileModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <header>
        <div class="header-content">
            <div class="logo" onclick="showCourses()" id="logoText">
                üéì Learning Platform
            </div>
            <div class="header-right">
                <button class="header-btn" onclick="openAISearch()" title="AI Search">
                    üîç
                </button>
                <button class="header-btn" onclick="openPrediction()" title="Learning Potential">
                    üéØ
                </button>
                <button class="header-btn" onclick="openSettings()" title="Settings">
                    ‚öôÔ∏è
                </button>
                <div id="userProfileContainer" style="position: relative;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </header>

    <!-- AI Chatbot Bubble -->
    <div class="chatbot-bubble" id="chatbotBubble" onclick="toggleChatbot()">
        <div class="chatbot-icon">ü§ñ</div>
    </div>

    <!-- AI Chatbot Window -->
    <div class="chatbot-window" id="chatbotWindow">
        <div class="chatbot-header">
            <div class="chatbot-header-title">
                <span>ü§ñ</span>
                <span>AI Assistant</span>
            </div>
            <button class="chatbot-close" onclick="toggleChatbot()">‚úï</button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="chatbot-message">
                <div class="chatbot-avatar">ü§ñ</div>
                <div class="chatbot-text">
                    Hi! I'm your AI learning assistant. How can I help you today? Ask me about courses, modules, or anything related to your learning journey!
                </div>
            </div>
        </div>
        <div class="chatbot-input-container">
            <input type="text" class="chatbot-input" id="chatbotInput" placeholder="Ask me anything..." onkeypress="handleChatbotKeyPress(event)">
            <button class="chatbot-send" onclick="sendChatbotMessage()">‚Üí</button>
        </div>
    </div>

    <div id="app">
        <!-- Content will be loaded here -->
    </div>
    
    <!-- Footer -->
    <footer style="background: var(--card); border-top: 1px solid var(--border); padding: 2rem; margin-top: 4rem; text-align: center;">
        <div style="max-width: 1400px; margin: 0 auto; display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;">
            <a href="legal/privacy-policy.html" target="_blank" style="color: var(--text-light); text-decoration: none;">Privacy Policy</a>
            <span style="color: var(--text-light);">|</span>
            <a href="legal/terms-of-service.html" target="_blank" style="color: var(--text-light); text-decoration: none;">Terms of Service</a>
            <span style="color: var(--text-light);">|</span>
            <a href="#" onclick="openGDPRSettings(); return false;" style="color: var(--text-light); text-decoration: none;">GDPR & Data</a>
        </div>
        <p style="color: var(--text-light); margin-top: 1rem; font-size: 0.875rem;">
            ¬© 2024 School. All rights reserved.
        </p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/security.js"></script>
    <script src="js/ai-config.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/migration-to-supabase.js"></script>
    <script src="js/enhanced-features.js"></script>
    <script src="js/3d-world.js"></script>
    <script src="js/universe-view.js"></script>
    <script src="js/certificates.js"></script>
    <script src="js/user-profiles.js"></script>
    <script src="js/scroll-header.js"></script>
    <script src="js/resizable-panels.js"></script>
    <script src="js/messaging.js"></script>
    <script src="js/assignments.js"></script>
    <script src="js/gdpr-compliance.js"></script>
    <script>
        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return hljs.highlight(code, { language: lang }).value;
                    } catch (err) {}
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: true,
            gfm: true
        });

        // Theme Management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
            updateThemeIcon(theme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }
        }

        // Watch for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
                document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
                updateThemeIcon(e.matches ? 'dark' : 'light');
            }
        });

        // Courses Data
        const courses = [
            {
                id: 'critical-thinking',
                title: 'Critical Thinking',
                description: 'Master clear reasoning and practical logic. Learn to think better and decide smarter.',
                icon: 'üß†',
                modules: 8,
                duration: '8 weeks',
                level: 'Intermediate',
                modules_data: [
                    { id: 1, title: 'Foundations of Critical Thinking', subtitle: 'What Is an Argument? Validity, Soundness, and Structure' },
                    { id: 2, title: 'Deduction: Propositional Logic & Syllogisms', subtitle: 'Guaranteed Truth Through Structure' },
                    { id: 3, title: 'Induction, Evidence & Strength', subtitle: 'From Specific to General' },
                    { id: 4, title: 'Probabilistic Thinking & Bayes', subtitle: 'Navigating Uncertainty' },
                    { id: 5, title: 'Cognitive Biases & Debiasing', subtitle: 'Overcoming Mental Shortcuts' },
                    { id: 6, title: 'Fallacies & Rhetoric', subtitle: 'Recognizing Faulty Reasoning' },
                    { id: 7, title: 'Constructing Strong Arguments', subtitle: 'Building Robust Reasoning' },
                    { id: 8, title: 'Decision-Making & Final Project', subtitle: 'Applying Critical Thinking' }
                ],
                // Translations for course content
                translations: {
                    el: {
                        title: 'ŒöœÅŒπœÑŒπŒ∫ŒÆ Œ£Œ∫Œ≠œàŒ∑',
                        description: 'ŒöŒ±œÑŒ≠Œ∫œÑŒ∑œÉŒµ œÑŒ∑ œÉŒ±œÜŒÆ œÉœÖŒªŒªŒøŒ≥ŒπœÉœÑŒπŒ∫ŒÆ Œ∫Œ±Œπ œÑŒ∑ŒΩ œÄœÅŒ±Œ∫œÑŒπŒ∫ŒÆ ŒªŒøŒ≥ŒπŒ∫ŒÆ. ŒúŒ¨Œ∏Œµ ŒΩŒ± œÉŒ∫Œ≠œÜœÑŒµœÉŒ±Œπ Œ∫Œ±ŒªœçœÑŒµœÅŒ± Œ∫Œ±Œπ ŒΩŒ± Œ±œÄŒøœÜŒ±œÉŒØŒ∂ŒµŒπœÇ œÄŒπŒø Œ≠ŒæœÖœÄŒΩŒ±.',
                        level: 'ŒúŒµœÉŒ±ŒØŒø',
                        duration: '8 ŒµŒ≤Œ¥ŒøŒºŒ¨Œ¥ŒµœÇ',
                        modules: [
                            { title: 'ŒòŒµŒºŒ≠ŒªŒπŒ± œÑŒ∑œÇ ŒöœÅŒπœÑŒπŒ∫ŒÆœÇ Œ£Œ∫Œ≠œàŒ∑œÇ', subtitle: 'Œ§Œπ ŒµŒØŒΩŒ±Œπ Œ≠ŒΩŒ± ŒµœÄŒπœáŒµŒØœÅŒ∑ŒºŒ±; ŒïŒ≥Œ∫œÖœÅœåœÑŒ∑œÑŒ±, ŒüœÅŒ∏œåœÑŒ∑œÑŒ± Œ∫Œ±Œπ ŒîŒøŒºŒÆ' },
                            { title: 'ŒëœÄŒ±Œ≥œâŒ≥ŒÆ: Œ†œÅŒøœÑŒ±œÉŒπŒ±Œ∫ŒÆ ŒõŒøŒ≥ŒπŒ∫ŒÆ & Œ£œÖŒªŒªŒøŒ≥ŒπœÉŒºŒøŒØ', subtitle: 'ŒïŒ≥Œ≥œÖŒ∑ŒºŒ≠ŒΩŒ∑ ŒëŒªŒÆŒ∏ŒµŒπŒ± ŒúŒ≠œÉœâ ŒîŒøŒºŒÆœÇ' },
                            { title: 'ŒïœÄŒ±Œ≥œâŒ≥ŒÆ, ŒëœÄŒøŒ¥ŒµŒπŒ∫œÑŒπŒ∫Œ¨ Œ£œÑŒøŒπœáŒµŒØŒ± & ŒôœÉœáœçœÇ', subtitle: 'ŒëœÄœå œÑŒø ŒïŒπŒ¥ŒπŒ∫œå œÉœÑŒø ŒìŒµŒΩŒπŒ∫œå' },
                            { title: 'Œ†ŒπŒ∏Œ±ŒΩŒøŒªŒøŒ≥ŒπŒ∫ŒÆ Œ£Œ∫Œ≠œàŒ∑ & Bayes', subtitle: 'Œ†ŒªŒøŒÆŒ≥Œ∑œÉŒ∑ œÉœÑŒ∑ŒΩ ŒëŒ≤ŒµŒ≤Œ±ŒπœåœÑŒ∑œÑŒ±' },
                            { title: 'ŒìŒΩœâœÉœÑŒπŒ∫Œ≠œÇ Œ†œÅŒøŒ∫Œ±œÑŒ±ŒªŒÆœàŒµŒπœÇ & ŒëœÄŒøœÄœÅŒøŒ∫Œ±œÑŒ¨ŒªŒ∑œàŒ∑', subtitle: 'Œ•œÄŒ≠œÅŒ≤Œ±œÉŒ∑ œÑœâŒΩ Œúental Œ£œÖŒΩœÑœåŒºœâŒΩ' },
                            { title: 'Œ£œÜŒ¨ŒªŒºŒ±œÑŒ± & Œ°Œ∑œÑŒøœÅŒπŒ∫ŒÆ', subtitle: 'ŒëŒΩŒ±Œ≥ŒΩœéœÅŒπœÉŒ∑ ŒïœÉœÜŒ±ŒªŒºŒ≠ŒΩŒ∑œÇ Œ£œÖŒªŒªŒøŒ≥ŒπœÉœÑŒπŒ∫ŒÆœÇ' },
                            { title: 'ŒöŒ±œÑŒ±œÉŒ∫ŒµœÖŒÆ ŒôœÉœáœÖœÅœéŒΩ ŒïœÄŒπœáŒµŒπœÅŒ∑ŒºŒ¨œÑœâŒΩ', subtitle: 'ŒîœåŒºŒ∑œÉŒ∑ Œ£œÑŒπŒ≤Œ±œÅŒÆœÇ Œ£œÖŒªŒªŒøŒ≥ŒπœÉœÑŒπŒ∫ŒÆœÇ' },
                            { title: 'ŒõŒÆœàŒ∑ ŒëœÄŒøœÜŒ¨œÉŒµœâŒΩ & Œ§ŒµŒªŒπŒ∫œå ŒàœÅŒ≥Œø', subtitle: 'ŒïœÜŒ±œÅŒºŒøŒ≥ŒÆ œÑŒ∑œÇ ŒöœÅŒπœÑŒπŒ∫ŒÆœÇ Œ£Œ∫Œ≠œàŒ∑œÇ' }
                        ]
                    }
                }
            },
            {
                id: 'personal-finance',
                title: 'Personal Finance & Investing',
                description: 'Take control of your financial future. Master budgeting, investing, and retirement planning.',
                icon: 'üí∞',
                modules: 8,
                duration: '8 weeks',
                level: 'Beginner',
                modules_data: [
                    { id: 1, title: 'Foundations of Personal Finance', subtitle: 'Budgeting, Emergency Funds, and Financial Goals' },
                    { id: 2, title: 'Understanding Debt & Credit', subtitle: 'Credit Scores, Debt Management, and Interest Rates' },
                    { id: 3, title: 'Banking & Savings Strategies', subtitle: 'Account Optimization and High-Yield Savings' },
                    { id: 4, title: 'Introduction to Investing', subtitle: 'Risk, Return, Asset Classes, and Investment Accounts' },
                    { id: 5, title: 'Stocks & Bonds Fundamentals', subtitle: 'Market Mechanics, ETFs, and Diversification' },
                    { id: 6, title: 'Retirement Planning', subtitle: '401(k), IRAs, Compound Interest, and Retirement Calculators' },
                    { id: 7, title: 'Tax Optimization', subtitle: 'Tax-Advantaged Accounts, Deductions, and Tax-Efficient Investing' },
                    { id: 8, title: 'Building Your Financial Plan', subtitle: 'Integration, Goal Prioritization, and Ongoing Management' }
                ],
                translations: {
                    el: {
                        title: 'Œ†œÅŒøœÉœâœÄŒπŒ∫Œ≠œÇ ŒüŒπŒ∫ŒøŒΩŒøŒºŒØŒµœÇ & ŒïœÄŒµŒΩŒ¥œçœÉŒµŒπœÇ',
                        description: 'Œ†Œ¨œÅŒµ œÑŒøŒΩ Œ≠ŒªŒµŒ≥œáŒø œÑŒøœÖ ŒøŒπŒ∫ŒøŒΩŒøŒºŒπŒ∫Œøœç œÉŒøœÖ ŒºŒ≠ŒªŒªŒøŒΩœÑŒøœÇ. ŒöŒ±œÑŒ≠Œ∫œÑŒ∑œÉŒµ œÑŒøŒΩ œÄœÅŒøŒ≥œÅŒ±ŒºŒºŒ±œÑŒπœÉŒºœå œÄœÅŒøœãœÄŒøŒªŒøŒ≥ŒπœÉŒºŒøœç, œÑŒπœÇ ŒµœÄŒµŒΩŒ¥œçœÉŒµŒπœÇ Œ∫Œ±Œπ œÑŒøŒΩ œÉœáŒµŒ¥ŒπŒ±œÉŒºœå œÉœÖŒΩœÑŒ±ŒæŒπŒøŒ¥œåœÑŒ∑œÉŒ∑œÇ.',
                        level: 'ŒëœÅœáŒ¨œÅŒπŒøœÇ',
                        duration: '8 ŒµŒ≤Œ¥ŒøŒºŒ¨Œ¥ŒµœÇ',
                        modules: [
                            { title: 'ŒòŒµŒºŒ≠ŒªŒπŒ± Œ†œÅŒøœÉœâœÄŒπŒ∫œéŒΩ ŒüŒπŒ∫ŒøŒΩŒøŒºŒπŒ∫œéŒΩ', subtitle: 'Œ†œÅŒøŒ≥œÅŒ±ŒºŒºŒ±œÑŒπœÉŒºœåœÇ Œ†œÅŒøœãœÄŒøŒªŒøŒ≥ŒπœÉŒºŒøœç, Œ§Œ±ŒºŒµŒØŒø ŒïœÄŒµŒØŒ≥ŒøœÖœÉŒ±œÇ ŒëŒΩŒ¨Œ≥Œ∫Œ∑œÇ Œ∫Œ±Œπ ŒüŒπŒ∫ŒøŒΩŒøŒºŒπŒ∫ŒøŒØ Œ£œÑœåœáŒøŒπ' },
                            { title: 'ŒöŒ±œÑŒ±ŒΩœåŒ∑œÉŒ∑ ŒßœÅŒ≠ŒøœÖœÇ & Œ†ŒØœÉœÑœâœÉŒ∑œÇ', subtitle: 'Œ†ŒπœÉœÑŒøœÄŒøŒπŒ∑œÑŒπŒ∫Œ¨ Œ†ŒØœÉœÑœâœÉŒ∑œÇ, ŒîŒπŒ±œáŒµŒØœÅŒπœÉŒ∑ ŒßœÅŒ≠ŒøœÖœÇ Œ∫Œ±Œπ Œ§œåŒ∫ŒøŒπ' },
                            { title: 'Œ§œÅŒ±œÄŒµŒ∂ŒπŒ∫Œ≠œÇ Œ•œÄŒ∑œÅŒµœÉŒØŒµœÇ & Œ£œÑœÅŒ±œÑŒ∑Œ≥ŒπŒ∫Œ≠œÇ ŒëœÄŒøœÑŒ±ŒºŒØŒµœÖœÉŒ∑œÇ', subtitle: 'ŒíŒµŒªœÑŒπœÉœÑŒøœÄŒøŒØŒ∑œÉŒ∑ ŒõŒøŒ≥Œ±œÅŒπŒ±œÉŒºœéŒΩ Œ∫Œ±Œπ Œ•œàŒ∑ŒªŒÆœÇ ŒëœÄœåŒ¥ŒøœÉŒ∑œÇ ŒëœÄŒøœÑŒ±ŒºŒØŒµœÖœÉŒ∑' },
                            { title: 'ŒïŒπœÉŒ±Œ≥œâŒ≥ŒÆ œÉœÑŒπœÇ ŒïœÄŒµŒΩŒ¥œçœÉŒµŒπœÇ', subtitle: 'ŒöŒØŒΩŒ¥œÖŒΩŒøœÇ, ŒïœÄŒπœÉœÑœÅŒøœÜŒÆ, ŒöŒ±œÑŒ∑Œ≥ŒøœÅŒØŒµœÇ Œ†ŒµœÅŒπŒøœÖœÉŒπŒ±Œ∫œéŒΩ Œ£œÑŒøŒπœáŒµŒØœâŒΩ Œ∫Œ±Œπ ŒïœÄŒµŒΩŒ¥œÖœÑŒπŒ∫ŒøŒØ ŒõŒøŒ≥Œ±œÅŒπŒ±œÉŒºŒøŒØ' },
                            { title: 'ŒíŒ±œÉŒπŒ∫Œ¨ ŒúŒµœÑŒøœáœéŒΩ & ŒüŒºŒøŒªœåŒ≥œâŒΩ', subtitle: 'ŒúŒ∑œáŒ±ŒΩŒπœÉŒºŒøŒØ ŒëŒ≥ŒøœÅŒ¨œÇ, ETFs Œ∫Œ±Œπ ŒîŒπŒ±œÜŒøœÅŒøœÄŒøŒØŒ∑œÉŒ∑' },
                            { title: 'Œ£œáŒµŒ¥ŒπŒ±œÉŒºœåœÇ Œ£œÖŒΩœÑŒ±ŒæŒπŒøŒ¥œåœÑŒ∑œÉŒ∑œÇ', subtitle: '401(k), IRAs, Œ£œçŒΩŒ∏ŒµœÑŒøœÇ Œ§œåŒ∫ŒøœÇ Œ∫Œ±Œπ Œ•œÄŒøŒªŒøŒ≥ŒπœÉœÑŒ≠œÇ Œ£œÖŒΩœÑŒ±ŒæŒπŒøŒ¥œåœÑŒ∑œÉŒ∑œÇ' },
                            { title: 'ŒíŒµŒªœÑŒπœÉœÑŒøœÄŒøŒØŒ∑œÉŒ∑ Œ¶œåœÅœâŒΩ', subtitle: 'Œ¶ŒøœÅŒøŒªŒøŒ≥ŒπŒ∫Œ¨ ŒïœÖŒΩŒøŒ∑ŒºŒ≠ŒΩŒøŒπ ŒõŒøŒ≥Œ±œÅŒπŒ±œÉŒºŒøŒØ, ŒïŒ∫œÄœÑœéœÉŒµŒπœÇ Œ∫Œ±Œπ Œ¶ŒøœÅŒøŒªŒøŒ≥ŒπŒ∫Œ¨ ŒëœÄŒøœÑŒµŒªŒµœÉŒºŒ±œÑŒπŒ∫Œ≠œÇ ŒïœÄŒµŒΩŒ¥œçœÉŒµŒπœÇ' },
                            { title: 'ŒîœåŒºŒ∑œÉŒ∑ œÑŒøœÖ ŒüŒπŒ∫ŒøŒΩŒøŒºŒπŒ∫Œøœç Œ£ŒøœÖ Œ£œáŒµŒ¥ŒØŒøœÖ', subtitle: 'ŒïŒΩœÉœâŒºŒ¨œÑœâœÉŒ∑, Œ†œÅŒøœÑŒµœÅŒ±ŒπŒøœÄŒøŒØŒ∑œÉŒ∑ Œ£œÑœåœáœâŒΩ Œ∫Œ±Œπ Œ£œÖŒΩŒµœáŒÆœÇ ŒîŒπŒ±œáŒµŒØœÅŒπœÉŒ∑' }
                        ]
                    }
                }
            },
            {
                id: 'ios-app-development',
                title: 'iOS App Development with SwiftUI',
                description: 'Build beautiful iPhone and iPad apps from scratch. Master SwiftUI, the future of Apple development.',
                icon: 'üì±',
                modules: 8,
                duration: '8 weeks',
                level: 'Beginner',
                modules_data: [
                    { id: 1, title: 'SwiftUI Foundations', subtitle: 'Views, Modifiers, and the Declarative Paradigm' },
                    { id: 2, title: 'Layout & Navigation', subtitle: 'Building Multi-Screen Apps with Navigation and Layouts' },
                    { id: 3, title: 'State Management', subtitle: 'Managing App State with @State, @Binding, and @ObservableObject' },
                    { id: 4, title: 'Lists & Data', subtitle: 'Displaying Dynamic Data with Lists, Models, and Persistence' },
                    { id: 5, title: 'User Input & Forms', subtitle: 'Collecting User Input with TextFields, Pickers, and Form Validation' },
                    { id: 6, title: 'Networking & APIs', subtitle: 'Fetching Data from the Internet with URLSession and async/await' },
                    { id: 7, title: 'Advanced UI', subtitle: 'Animations, Gestures, and Custom Views' },
                    { id: 8, title: 'App Store Deployment', subtitle: 'Testing, Certificates, and Publishing Your App' }
                ],
                translations: {
                    el: {
                        title: 'ŒëŒΩŒ¨œÄœÑœÖŒæŒ∑ iOS ŒïœÜŒ±œÅŒºŒøŒ≥œéŒΩ ŒºŒµ SwiftUI',
                        description: 'ŒîŒ∑ŒºŒπŒøœçœÅŒ≥Œ∑œÉŒµ œåŒºŒøœÅœÜŒµœÇ ŒµœÜŒ±œÅŒºŒøŒ≥Œ≠œÇ iPhone Œ∫Œ±Œπ iPad Œ±œÄœå œÑŒ∑ŒΩ Œ±œÅœáŒÆ. ŒöŒ±œÑŒ≠Œ∫œÑŒ∑œÉŒµ œÑŒø SwiftUI, œÑŒø ŒºŒ≠ŒªŒªŒøŒΩ œÑŒ∑œÇ Œ±ŒΩŒ¨œÄœÑœÖŒæŒ∑œÇ Apple.',
                        level: 'ŒëœÅœáŒ¨œÅŒπŒøœÇ',
                        duration: '8 ŒµŒ≤Œ¥ŒøŒºŒ¨Œ¥ŒµœÇ',
                        modules: [
                            { title: 'ŒòŒµŒºŒ≠ŒªŒπŒ± SwiftUI', subtitle: 'Views, Modifiers Œ∫Œ±Œπ Œ∑ ŒîŒ∑ŒªœâœÑŒπŒ∫ŒÆ Œ†Œ±œÅŒ¨Œ¥ŒµŒπŒ≥ŒºŒ±' },
                            { title: 'ŒîŒπŒ¨œÑŒ±ŒæŒ∑ & Œ†ŒªŒøŒÆŒ≥Œ∑œÉŒ∑', subtitle: 'ŒîœåŒºŒ∑œÉŒ∑ ŒïœÜŒ±œÅŒºŒøŒ≥œéŒΩ Œ†ŒøŒªŒªŒ±œÄŒªœéŒΩ ŒüŒ∏ŒøŒΩœéŒΩ ŒºŒµ Œ†ŒªŒøŒÆŒ≥Œ∑œÉŒ∑ Œ∫Œ±Œπ ŒîŒπŒ±œÑŒ¨ŒæŒµŒπœÇ' },
                            { title: 'ŒîŒπŒ±œáŒµŒØœÅŒπœÉŒ∑ ŒöŒ±œÑŒ¨œÉœÑŒ±œÉŒ∑œÇ', subtitle: 'ŒîŒπŒ±œáŒµŒØœÅŒπœÉŒ∑ ŒöŒ±œÑŒ¨œÉœÑŒ±œÉŒ∑œÇ ŒïœÜŒ±œÅŒºŒøŒ≥ŒÆœÇ ŒºŒµ @State, @Binding Œ∫Œ±Œπ @ObservableObject' },
                            { title: 'ŒõŒØœÉœÑŒµœÇ & ŒîŒµŒ¥ŒøŒºŒ≠ŒΩŒ±', subtitle: 'ŒïŒºœÜŒ¨ŒΩŒπœÉŒ∑ ŒîœÖŒΩŒ±ŒºŒπŒ∫œéŒΩ ŒîŒµŒ¥ŒøŒºŒ≠ŒΩœâŒΩ ŒºŒµ ŒõŒØœÉœÑŒµœÇ, ŒúŒøŒΩœÑŒ≠ŒªŒ± Œ∫Œ±Œπ ŒïœÄŒØŒºŒøŒΩŒ∑ ŒëœÄŒøŒ∏ŒÆŒ∫ŒµœÖœÉŒ∑' },
                            { title: 'ŒïŒØœÉŒøŒ¥ŒøœÇ ŒßœÅŒÆœÉœÑŒ∑ & Œ¶œåœÅŒºŒµœÇ', subtitle: 'Œ£œÖŒªŒªŒøŒ≥ŒÆ ŒïŒπœÉœåŒ¥ŒøœÖ ŒßœÅŒÆœÉœÑŒ∑ ŒºŒµ TextFields, Pickers Œ∫Œ±Œπ ŒïœÄŒπŒ∫œçœÅœâœÉŒ∑ Œ¶œåœÅŒºŒ±œÇ' },
                            { title: 'ŒîŒπŒ∫œÑœçœâœÉŒ∑ & APIs', subtitle: 'ŒõŒÆœàŒ∑ ŒîŒµŒ¥ŒøŒºŒ≠ŒΩœâŒΩ Œ±œÄœå œÑŒø Internet ŒºŒµ URLSession Œ∫Œ±Œπ async/await' },
                            { title: 'Œ†œÅŒøœáœâœÅŒ∑ŒºŒ≠ŒΩŒø UI', subtitle: 'ŒöŒπŒΩŒøœçŒºŒµŒΩŒµœÇ ŒïŒπŒ∫œåŒΩŒµœÇ, ŒßŒµŒπœÅŒøŒΩŒøŒºŒØŒµœÇ Œ∫Œ±Œπ Œ†œÅŒøœÉŒ±œÅŒºŒøœÉŒºŒ≠ŒΩŒµœÇ Œ†œÅŒøŒ≤ŒøŒªŒ≠œÇ' },
                            { title: 'ŒëŒΩŒ¨œÄœÑœÖŒæŒ∑ App Store', subtitle: 'ŒîŒøŒ∫ŒπŒºŒÆ, Œ†ŒπœÉœÑŒøœÄŒøŒπŒ∑œÑŒπŒ∫Œ¨ Œ∫Œ±Œπ ŒîŒ∑ŒºŒøœÉŒØŒµœÖœÉŒ∑ œÑŒ∑œÇ ŒïœÜŒ±œÅŒºŒøŒ≥ŒÆœÇ œÉŒøœÖ' }
                        ]
                    }
                }
            },
            {
                id: 'vibecoding',
                title: 'Vibecoding with Cursor',
                description: 'Build production apps 10x faster with AI. Master the art of AI-assisted development with Cursor.',
                icon: '‚ö°',
                modules: 8,
                duration: '8 weeks',
                level: 'Beginner to Advanced',
                modules_data: [
                    { id: 1, title: 'Foundations of Vibecoding', subtitle: 'Introduction to AI-Assisted Development with Cursor' },
                    { id: 2, title: 'CURSOR_RULES: Defining Your Tech Stack', subtitle: 'Creating Effective CURSOR_RULES.md Files' },
                    { id: 3, title: 'INSTRUCTIONS: Requirements & Planning', subtitle: 'Writing Comprehensive INSTRUCTIONS.md Files' },
                    { id: 4, title: 'Code Generation & Structure', subtitle: 'Prompt Engineering for Code Generation' },
                    { id: 5, title: 'Iterative Refinement', subtitle: 'Incremental Updates and Improvements' },
                    { id: 6, title: 'Testing & Quality Assurance', subtitle: 'Ensuring AI-Generated Code Works Correctly' },
                    { id: 7, title: 'Integration & Deployment', subtitle: 'Connecting APIs and Shipping to Production' },
                    { id: 8, title: 'Advanced Techniques & Final Project', subtitle: 'Mastering Complex Patterns and Building Your Portfolio' }
                ],
                translations: {
                    el: {
                        title: 'Vibecoding ŒºŒµ Cursor',
                        description: 'ŒîŒ∑ŒºŒπŒøœçœÅŒ≥Œ∑œÉŒµ ŒµœÜŒ±œÅŒºŒøŒ≥Œ≠œÇ œÄŒ±œÅŒ±Œ≥œâŒ≥ŒÆœÇ 10 œÜŒøœÅŒ≠œÇ œÄŒπŒø Œ≥œÅŒÆŒ≥ŒøœÅŒ± ŒºŒµ AI. ŒöŒ±œÑŒ≠Œ∫œÑŒ∑œÉŒµ œÑŒ∑ŒΩ œÑŒ≠œáŒΩŒ∑ œÑŒ∑œÇ Œ±ŒΩŒ¨œÄœÑœÖŒæŒ∑œÇ ŒºŒµ Œ≤ŒøŒÆŒ∏ŒµŒπŒ± AI ŒºŒµ Cursor.',
                        level: 'ŒëœÅœáŒ¨œÅŒπŒøœÇ Œ≠œâœÇ Œ†œÅŒøœáœâœÅŒ∑ŒºŒ≠ŒΩŒøœÇ',
                        duration: '8 ŒµŒ≤Œ¥ŒøŒºŒ¨Œ¥ŒµœÇ',
                        modules: [
                            { title: 'ŒòŒµŒºŒ≠ŒªŒπŒ± Vibecoding', subtitle: 'ŒïŒπœÉŒ±Œ≥œâŒ≥ŒÆ œÉœÑŒ∑ŒΩ ŒëŒΩŒ¨œÄœÑœÖŒæŒ∑ ŒºŒµ ŒíŒøŒÆŒ∏ŒµŒπŒ± AI ŒºŒµ Cursor' },
                            { title: 'CURSOR_RULES: ŒüœÅŒπœÉŒºœåœÇ Tech Stack', subtitle: 'ŒîŒ∑ŒºŒπŒøœÖœÅŒ≥ŒØŒ± ŒëœÄŒøœÑŒµŒªŒµœÉŒºŒ±œÑŒπŒ∫œéŒΩ ŒëœÅœáŒµŒØœâŒΩ CURSOR_RULES.md' },
                            { title: 'INSTRUCTIONS: ŒëœÄŒ±ŒπœÑŒÆœÉŒµŒπœÇ & Œ£œáŒµŒ¥ŒπŒ±œÉŒºœåœÇ', subtitle: 'Œ£œçŒΩœÑŒ±ŒæŒ∑ ŒüŒªŒøŒ∫ŒªŒ∑œÅœâŒºŒ≠ŒΩœâŒΩ ŒëœÅœáŒµŒØœâŒΩ INSTRUCTIONS.md' },
                            { title: 'ŒîŒ∑ŒºŒπŒøœÖœÅŒ≥ŒØŒ± ŒöœéŒ¥ŒπŒ∫Œ± & ŒîŒøŒºŒÆ', subtitle: 'ŒúŒ∑œáŒ±ŒΩŒπŒ∫ŒÆ Œ†œÅŒøœÑœÅŒøœÄœéŒΩ Œ≥ŒπŒ± ŒîŒ∑ŒºŒπŒøœÖœÅŒ≥ŒØŒ± ŒöœéŒ¥ŒπŒ∫Œ±' },
                            { title: 'ŒïœÄŒ±ŒΩŒ±ŒªŒ∑œÄœÑŒπŒ∫ŒÆ ŒíŒµŒªœÑŒØœâœÉŒ∑', subtitle: 'ŒëœÖŒæŒ±ŒΩœåŒºŒµŒΩŒµœÇ ŒïŒΩŒ∑ŒºŒµœÅœéœÉŒµŒπœÇ Œ∫Œ±Œπ ŒíŒµŒªœÑŒπœéœÉŒµŒπœÇ' },
                            { title: 'ŒîŒøŒ∫ŒπŒºŒÆ & ŒïŒæŒ±œÉœÜŒ¨ŒªŒπœÉŒ∑ Œ†ŒøŒπœåœÑŒ∑œÑŒ±œÇ', subtitle: 'ŒïŒæŒ±œÉœÜŒ¨ŒªŒπœÉŒ∑ œåœÑŒπ Œø AI-ŒîŒ∑ŒºŒπŒøœÖœÅŒ≥Œ∑ŒºŒ≠ŒΩŒøœÇ ŒöœéŒ¥ŒπŒ∫Œ±œÇ ŒõŒµŒπœÑŒøœÖœÅŒ≥ŒµŒØ Œ£œâœÉœÑŒ¨' },
                            { title: 'ŒïŒΩœÉœâŒºŒ¨œÑœâœÉŒ∑ & ŒëŒΩŒ¨œÄœÑœÖŒæŒ∑', subtitle: 'Œ£œçŒΩŒ¥ŒµœÉŒ∑ APIs Œ∫Œ±Œπ ŒëœÄŒøœÉœÑŒøŒªŒÆ œÉœÑŒ∑ŒΩ Œ†Œ±œÅŒ±Œ≥œâŒ≥ŒÆ' },
                            { title: 'Œ†œÅŒøœáœâœÅŒ∑ŒºŒ≠ŒΩŒµœÇ Œ§ŒµœáŒΩŒπŒ∫Œ≠œÇ & Œ§ŒµŒªŒπŒ∫œå ŒàœÅŒ≥Œø', subtitle: 'ŒöŒ±œÑŒ¨Œ∫œÑŒ∑œÉŒ∑ Œ£œçŒΩŒ∏ŒµœÑœâŒΩ ŒúŒøœÑŒØŒ≤œâŒΩ Œ∫Œ±Œπ ŒîœåŒºŒ∑œÉŒ∑ Portfolio' }
                        ]
                    }
                }
            },
            {
                id: 'human-minds',
                title: 'Understanding Human Minds',
                description: 'Transform your understanding of human nature. Explore theology, narcissism, and optimistic living with compassion.',
                icon: 'üßò',
                modules: 8,
                duration: '8 weeks',
                level: 'Beginner to Intermediate',
                modules_data: [
                    { id: 1, title: 'The Human Mind: An Introduction', subtitle: 'Understanding Consciousness, Self-Awareness, and Mental Frameworks' },
                    { id: 2, title: 'Theology & Human Nature', subtitle: 'Exploring Spiritual Perspectives on the Human Condition' },
                    { id: 3, title: 'Narcissism: Understanding the Spectrum', subtitle: 'Recognizing Patterns with Compassion and Clarity' },
                    { id: 4, title: 'The Optimist\'s Mindset', subtitle: 'Cultivating Realistic Optimism and Resilience' },
                    { id: 5, title: 'Self-Awareness & Growth', subtitle: 'Developing Emotional Intelligence and Introspection' },
                    { id: 6, title: 'Relationships & Boundaries', subtitle: 'Building Healthy Connections While Protecting Yourself' },
                    { id: 7, title: 'Spiritual Practices & Mindfulness', subtitle: 'Integrating Wisdom Traditions for Daily Living' },
                    { id: 8, title: 'Integration & Transformation', subtitle: 'Bringing It All Together for Lasting Change' }
                ],
                translations: {
                    el: {
                        title: 'ŒöŒ±œÑŒ±ŒΩœåŒ∑œÉŒ∑ ŒëŒΩŒ∏œÅœéœÄŒπŒΩœâŒΩ ŒùŒøœÖ',
                        description: 'ŒúŒµœÑŒ±ŒºŒøœÅœÜœéœÉœÑŒµ œÑŒ∑ŒΩ Œ∫Œ±œÑŒ±ŒΩœåŒ∑œÉŒÆ œÉŒ±œÇ Œ≥ŒπŒ± œÑŒ∑ŒΩ Œ±ŒΩŒ∏œÅœéœÄŒπŒΩŒ∑ œÜœçœÉŒ∑. ŒïŒæŒµœÅŒµœÖŒΩŒÆœÉœÑŒµ œÑŒ∑ Œ∏ŒµŒøŒªŒøŒ≥ŒØŒ±, œÑŒøŒΩ ŒΩŒ±œÅŒ∫ŒπœÉœÉŒπœÉŒºœå Œ∫Œ±Œπ œÑŒøŒΩ Œ±ŒπœÉŒπœåŒ¥ŒøŒæŒø œÑœÅœåœÄŒø Œ∂œâŒÆœÇ ŒºŒµ œÉœÖŒºœÄœåŒΩŒπŒ±.',
                        level: 'ŒëœÅœáŒ¨œÅŒπŒøœÇ Œ≠œâœÇ ŒúŒµœÉŒ±ŒØŒø',
                        duration: '8 ŒµŒ≤Œ¥ŒøŒºŒ¨Œ¥ŒµœÇ',
                        modules: [
                            { title: 'Œü ŒëŒΩŒ∏œÅœéœÄŒπŒΩŒøœÇ ŒùŒøœÖœÇ: ŒïŒπœÉŒ±Œ≥œâŒ≥ŒÆ', subtitle: 'ŒöŒ±œÑŒ±ŒΩœåŒ∑œÉŒ∑ Œ£œÖŒΩŒµŒØŒ¥Œ∑œÉŒ∑œÇ, ŒëœÖœÑŒøŒ≥ŒΩœâœÉŒØŒ±œÇ Œ∫Œ±Œπ ŒùŒøŒ∑œÑŒπŒ∫œéŒΩ Œ†ŒªŒ±ŒπœÉŒØœâŒΩ' },
                            { title: 'ŒòŒµŒøŒªŒøŒ≥ŒØŒ± & ŒëŒΩŒ∏œÅœéœÄŒπŒΩŒ∑ Œ¶œçœÉŒ∑', subtitle: 'ŒïŒæŒµœÅŒµœçŒΩŒ∑œÉŒ∑ Œ†ŒΩŒµœÖŒºŒ±œÑŒπŒ∫œéŒΩ Œ†œÅŒøŒøœÄœÑŒπŒ∫œéŒΩ Œ≥ŒπŒ± œÑŒ∑ŒΩ ŒëŒΩŒ∏œÅœéœÄŒπŒΩŒ∑ ŒöŒ±œÑŒ¨œÉœÑŒ±œÉŒ∑' },
                            { title: 'ŒùŒ±œÅŒ∫ŒπœÉœÉŒπœÉŒºœåœÇ: ŒöŒ±œÑŒ±ŒΩœåŒ∑œÉŒ∑ œÑŒøœÖ Œ¶Œ¨œÉŒºŒ±œÑŒøœÇ', subtitle: 'ŒëŒΩŒ±Œ≥ŒΩœéœÅŒπœÉŒ∑ ŒúŒøœÑŒØŒ≤œâŒΩ ŒºŒµ Œ£œÖŒºœÄœåŒΩŒπŒ± Œ∫Œ±Œπ Œ£Œ±œÜŒÆŒΩŒµŒπŒ±' },
                            { title: 'Œó ŒùŒøŒøœÑœÅŒøœÄŒØŒ± œÑŒøœÖ ŒëŒπœÉŒπœåŒ¥ŒøŒæŒøœÖ', subtitle: 'ŒöŒ±ŒªŒªŒπŒ≠œÅŒ≥ŒµŒπŒ± Œ°ŒµŒ±ŒªŒπœÉœÑŒπŒ∫Œøœç ŒüœÄœÑŒπŒºŒπœÉŒºŒøœç Œ∫Œ±Œπ ŒëŒΩŒ∏ŒµŒ∫œÑŒπŒ∫œåœÑŒ∑œÑŒ±œÇ' },
                            { title: 'ŒëœÖœÑŒøŒ≥ŒΩœâœÉŒØŒ± & ŒëŒΩŒ¨œÄœÑœÖŒæŒ∑', subtitle: 'ŒëŒΩŒ¨œÄœÑœÖŒæŒ∑ Œ£œÖŒΩŒ±ŒπœÉŒ∏Œ∑ŒºŒ±œÑŒπŒ∫ŒÆœÇ ŒùŒøŒ∑ŒºŒøœÉœçŒΩŒ∑œÇ Œ∫Œ±Œπ ŒïœÉœâœÑŒµœÅŒπŒ∫ŒÆœÇ ŒëŒΩŒ¨Œ∫œÅŒπœÉŒ∑œÇ' },
                            { title: 'Œ£œáŒ≠œÉŒµŒπœÇ & ŒåœÅŒπŒ±', subtitle: 'ŒîœåŒºŒ∑œÉŒ∑ Œ•Œ≥ŒπœéŒΩ Œ£œÖŒΩŒ¥Œ≠œÉŒµœâŒΩ ŒµŒΩœé Œ†œÅŒøœÉœÑŒ±œÑŒµœçŒµœÑŒµ œÑŒøŒΩ ŒïŒ±œÖœÑœå œÉŒ±œÇ' },
                            { title: 'Œ†ŒΩŒµœÖŒºŒ±œÑŒπŒ∫Œ≠œÇ Œ†œÅŒ±Œ∫œÑŒπŒ∫Œ≠œÇ & ŒïŒ≥œÅŒÆŒ≥ŒøœÅœÉŒ∑', subtitle: 'ŒïŒΩœÉœâŒºŒ¨œÑœâœÉŒ∑ Œ†Œ±œÅŒ±Œ¥œåœÉŒµœâŒΩ Œ£ŒøœÜŒØŒ±œÇ Œ≥ŒπŒ± œÑŒ∑ŒΩ ŒöŒ±Œ∏Œ∑ŒºŒµœÅŒπŒΩŒÆ ŒñœâŒÆ' },
                            { title: 'ŒïŒΩœÉœâŒºŒ¨œÑœâœÉŒ∑ & ŒúŒµœÑŒ±ŒºœåœÅœÜœâœÉŒ∑', subtitle: 'Œ£œÖŒ≥Œ∫Œ≠ŒΩœÑœÅœâœÉŒ∑ ŒåŒªœâŒΩ ŒúŒ±Œ∂ŒØ Œ≥ŒπŒ± ŒúœåŒΩŒπŒºŒ∑ ŒëŒªŒªŒ±Œ≥ŒÆ' }
                        ]
                    }
                }
            },
            {
                id: 'sign-language',
                title: 'American Sign Language (ASL)',
                description: 'Connect through your hands. Master ASL with visual learning & cultural understanding. 8 weeks to fluency.',
                icon: 'ü§ü',
                modules: 8,
                duration: '8 weeks',
                level: 'Beginner to Intermediate',
                modules_data: [
                    { id: 1, title: 'ASL Basics & Fingerspelling', subtitle: 'Your First Steps in American Sign Language' },
                    { id: 2, title: 'Greetings & Introductions', subtitle: 'Meeting People in ASL' },
                    { id: 3, title: 'Daily Life & Activities', subtitle: 'Talking About Your Life in ASL' },
                    { id: 4, title: 'Questions & Conversations', subtitle: 'Asking Questions and Having Conversations in ASL' },
                    { id: 5, title: 'Time & Calendar', subtitle: 'Expressing Time in ASL' },
                    { id: 6, title: 'Emotions & Descriptions', subtitle: 'Expressing Feelings and Describing in ASL' },
                    { id: 7, title: 'Deaf Culture & Community', subtitle: 'Understanding Deaf Culture and Community' },
                    { id: 8, title: 'Advanced Communication', subtitle: 'Storytelling, Fluency, and Real-World ASL' }
                ],
                translations: {
                    el: {
                        title: 'ŒëŒºŒµœÅŒπŒ∫Œ±ŒΩŒπŒ∫ŒÆ ŒùŒøŒ∑ŒºŒ±œÑŒπŒ∫ŒÆ ŒìŒªœéœÉœÉŒ± (ASL)',
                        description: 'Œ£œÖŒΩŒ¥ŒµŒ∏ŒµŒØœÑŒµ ŒºŒ≠œÉœâ œÑœâŒΩ œáŒµœÅŒπœéŒΩ œÉŒ±œÇ. ŒöŒ±œÑŒ≠Œ∫œÑŒ∑œÉŒµ œÑŒ∑ŒΩ ASL ŒºŒµ ŒøœÄœÑŒπŒ∫ŒÆ ŒºŒ¨Œ∏Œ∑œÉŒ∑ Œ∫Œ±Œπ œÄŒøŒªŒπœÑŒπœÉœÑŒπŒ∫ŒÆ Œ∫Œ±œÑŒ±ŒΩœåŒ∑œÉŒ∑. 8 ŒµŒ≤Œ¥ŒøŒºŒ¨Œ¥ŒµœÇ Œ≥ŒπŒ± ŒµœÖœáŒ≠œÅŒµŒπŒ±.',
                        level: 'ŒëœÅœáŒ¨œÅŒπŒøœÇ Œ≠œâœÇ ŒúŒµœÉŒ±ŒØŒø',
                        duration: '8 ŒµŒ≤Œ¥ŒøŒºŒ¨Œ¥ŒµœÇ',
                        modules: [
                            { title: 'ŒíŒ±œÉŒπŒ∫Œ¨ ASL & ŒùŒøŒ∑ŒºŒ±œÑŒπŒ∫ŒÆ ŒëŒªœÜŒ±Œ≤ŒÆœÑŒ±', subtitle: 'Œ§Œ± Œ†œÅœéœÑŒ± Œ£Œ±œÇ ŒíŒÆŒºŒ±œÑŒ± œÉœÑŒ∑ŒΩ ŒëŒºŒµœÅŒπŒ∫Œ±ŒΩŒπŒ∫ŒÆ ŒùŒøŒ∑ŒºŒ±œÑŒπŒ∫ŒÆ ŒìŒªœéœÉœÉŒ±' },
                            { title: 'ŒßŒ±ŒπœÅŒµœÑŒπœÉŒºŒøŒØ & Œ£œÖŒΩŒ±ŒΩœÑŒÆœÉŒµŒπœÇ', subtitle: 'ŒìŒΩœâœÅŒπŒºŒØŒ± ŒºŒµ ŒëŒΩŒ∏œÅœéœÄŒøœÖœÇ œÉŒµ ASL' },
                            { title: 'ŒöŒ±Œ∏Œ∑ŒºŒµœÅŒπŒΩŒÆ ŒñœâŒÆ & ŒîœÅŒ±œÉœÑŒ∑œÅŒπœåœÑŒ∑œÑŒµœÇ', subtitle: 'ŒúŒπŒªœéŒΩœÑŒ±œÇ Œ≥ŒπŒ± œÑŒ∑ ŒñœâŒÆ œÉŒ±œÇ œÉŒµ ASL' },
                            { title: 'ŒïœÅœâœÑŒÆœÉŒµŒπœÇ & Œ£œÖŒΩŒøŒºŒπŒªŒØŒµœÇ', subtitle: 'ŒöŒ¨ŒΩŒøŒΩœÑŒ±œÇ ŒïœÅœâœÑŒÆœÉŒµŒπœÇ Œ∫Œ±Œπ Œ£œÖŒΩŒøŒºŒπŒªœéŒΩœÑŒ±œÇ œÉŒµ ASL' },
                            { title: 'ŒßœÅœåŒΩŒøœÇ & ŒóŒºŒµœÅŒøŒªœåŒ≥ŒπŒø', subtitle: 'ŒïŒ∫œÜœÅŒ¨Œ∂ŒøŒΩœÑŒ±œÇ œÑŒøŒΩ ŒßœÅœåŒΩŒø œÉŒµ ASL' },
                            { title: 'Œ£œÖŒΩŒ±ŒπœÉŒ∏ŒÆŒºŒ±œÑŒ± & Œ†ŒµœÅŒπŒ≥œÅŒ±œÜŒ≠œÇ', subtitle: 'ŒïŒ∫œÜœÅŒ¨Œ∂ŒøŒΩœÑŒ±œÇ Œ£œÖŒΩŒ±ŒπœÉŒ∏ŒÆŒºŒ±œÑŒ± Œ∫Œ±Œπ Œ†ŒµœÅŒπŒ≥œÅŒ¨œÜŒøŒΩœÑŒ±œÇ œÉŒµ ASL' },
                            { title: 'ŒöŒøœÖŒªœÑŒøœçœÅŒ± ŒöœâœÜœéŒΩ & ŒöŒøŒπŒΩœåœÑŒ∑œÑŒ±', subtitle: 'ŒöŒ±œÑŒ±ŒΩœåŒ∑œÉŒ∑ œÑŒ∑œÇ ŒöŒøœÖŒªœÑŒøœçœÅŒ±œÇ Œ∫Œ±Œπ œÑŒ∑œÇ ŒöŒøŒπŒΩœåœÑŒ∑œÑŒ±œÇ ŒöœâœÜœéŒΩ' },
                            { title: 'Œ†œÅŒøœáœâœÅŒ∑ŒºŒ≠ŒΩŒ∑ ŒïœÄŒπŒ∫ŒøŒπŒΩœâŒΩŒØŒ±', subtitle: 'ŒëœÜŒÆŒ≥Œ∑œÉŒ∑, ŒïœÖœáŒ≠œÅŒµŒπŒ± Œ∫Œ±Œπ ASL œÉœÑŒøŒΩ Œ†œÅŒ±Œ≥ŒºŒ±œÑŒπŒ∫œå ŒöœåœÉŒºŒø' }
                        ]
                    }
                }
            }
            // More courses can be added here
        ];
        
        // Make courses globally available (translated based on current language)
        window.courses = courses;
        
        // Function to get translated courses
        window.getTranslatedCourses = function() {
            if (window.i18n) {
                return window.i18n.translateCourses(courses);
            }
            return courses;
        };
        
        // Function to get translated course by ID
        window.getTranslatedCourse = function(courseId) {
            const allCourses = window.getTranslatedCourses();
            return allCourses.find(c => c.id === courseId);
        };

        // User state
        let user = JSON.parse(localStorage.getItem('user') || 'null');
        let currentCourse = null;
        let currentQuiz = null;
        let quizAnswers = {};

        // Course state
        const state = {
            currentCourseId: null,
            currentModule: 1,
            completedModules: JSON.parse(localStorage.getItem('completedModules') || '[]'),
            quizScores: JSON.parse(localStorage.getItem('quizScores') || '{}'),
            totalModules: 0,
            sidebarView: null // 'messages', 'assignments', or null for modules
        };

        // Initialize
        function init() {
            initTheme();
            // Initialize theme and layout managers
            if (typeof ViewModeManager !== 'undefined') {
                ViewModeManager.init();
            }
            if (typeof ThemeManager !== 'undefined') {
                ThemeManager.init();
            }
            if (typeof UILayoutManager !== 'undefined') {
                UILayoutManager.init();
            }
            
            // Initialize logo text with i18n
            if (window.i18n) {
                const logoText = document.getElementById('logoText');
                if (logoText) {
                    logoText.textContent = window.i18n.t('logo');
                }
            }
            
            if (user) {
                // Initialize default friends if not already done
                if (typeof UserProfileManager !== 'undefined' && UserProfileManager.initDefaultFriends) {
                    UserProfileManager.initDefaultFriends();
                }
                updateUserDisplay();
            } else {
                showSignInButton();
            }
            showCourses();
        }

        // Show courses listing with 3D hero
        function showCourses() {
            state.currentCourseId = null;
            const app = document.getElementById('app');
            if (!app) {
                console.error('App element not found!');
                return;
            }
            
            // Check view mode from ViewModeManager
            const viewMode = (typeof ViewModeManager !== 'undefined' && ViewModeManager.getCurrentMode) 
                ? ViewModeManager.getCurrentMode() 
                : (localStorage.getItem('viewMode') || 'enhanced');
            
            // Use custom layout if available, otherwise use default
            const translatedCourses = window.getTranslatedCourses ? window.getTranslatedCourses() : courses;
            
            // Safety check - ensure we have courses
            if (!translatedCourses || translatedCourses.length === 0) {
                console.error('No courses found!', { courses, translatedCourses });
                app.innerHTML = `
                    <div style="padding: 2rem; text-align: center;">
                        <h2>No courses available</h2>
                        <p>Please check the console for errors.</p>
                    </div>
                `;
                return;
            }
            
            // Handle 3D World view mode
            if (viewMode === '3d-world') {
                app.innerHTML = `
                    <div class="courses-container" id="courses-container" style="padding: 0; height: 100vh; overflow: hidden;">
                        <!-- 3D World will be initialized here -->
                    </div>
                `;
                // Initialize 3D world
                setTimeout(() => {
                    if (typeof init3DWorld === 'function') {
                        init3DWorld();
                    } else if (typeof ThreeDWorld !== 'undefined') {
                        ThreeDWorld.init();
                    }
                }, 100);
                return;
            }
            
            // Handle Universe view mode
            if (viewMode === 'universe') {
                app.innerHTML = `
                    <div class="courses-container" id="courses-container" style="padding: 0; height: 100vh; overflow: hidden;">
                        <!-- Universe View will be initialized here -->
                    </div>
                `;
                // Initialize Universe view
                setTimeout(() => {
                    if (typeof initUniverseView === 'function') {
                        initUniverseView();
                    } else if (typeof UniverseView !== 'undefined') {
                        UniverseView.init();
                    }
                }, 100);
                return;
            }
            
            // Handle Simple view mode (no 3D effects)
            if (viewMode === 'simple') {
                const simpleHTML = `
                    <div class="courses-container">
                        <div class="page-header">
                            <h1 class="page-title">${window.i18n ? (window.i18n.t('courses') || 'Courses') : 'Courses'}</h1>
                            <p class="page-subtitle">${window.i18n ? (window.i18n.t('selectCourse') || 'Select a course to begin') : 'Select a course to begin'}</p>
                        </div>
                        <div class="courses-grid" id="coursesSection">
                            ${translatedCourses.map(course => `
                                <div class="course-card" onclick="loadCourse('${course.id}')" style="transform: none !important;">
                                    <div class="course-icon">${course.icon}</div>
                                    <h2 class="course-title">${course.title}</h2>
                                    <p class="course-description">${course.description}</p>
                                    <div class="course-meta">
                                        <span>üìö ${course.modules} ${window.i18n ? window.i18n.t('modules') : 'modules'}</span>
                                        <span>‚è±Ô∏è ${course.duration}</span>
                                        <span>üìä ${course.level}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                app.innerHTML = simpleHTML;
                return;
            }
            
            // Enhanced view mode (with 3D effects) - default behavior
            let layoutHTML = null;
            if (typeof UILayoutManager !== 'undefined' && UILayoutManager.renderCourses) {
                try {
                    const layout = UILayoutManager.currentLayout || 'modern';
                    layoutHTML = UILayoutManager.renderCourses(layout);
                } catch (e) {
                    console.warn('UILayoutManager error:', e);
                    layoutHTML = null;
                }
            }
            
            const coursesHTML = layoutHTML || `
                <div class="modern-courses-grid" id="coursesSection">
                    ${translatedCourses.map(course => `
                        <div class="modern-course-card" onclick="loadCourse('${course.id}')">
                            <div class="modern-course-icon">${course.icon}</div>
                            <h2 class="modern-course-title">${course.title}</h2>
                            <p class="modern-course-description">${course.description}</p>
                            <div class="modern-course-meta">
                                <span>üìö ${course.modules} ${window.i18n ? window.i18n.t('modules') : 'modules'}</span>
                                <span>‚è±Ô∏è ${course.duration}</span>
                                <span>üìä ${course.level}</span>
                            </div>
                            <div class="modern-course-arrow">
                                ${window.i18n ? (window.i18n.t('startCourse') || 'Start Learning') : 'Start Learning'} ‚Üí
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Always show 3D hero first, then courses
            app.innerHTML = `
                <div class="hero-section">
                    <div class="floating-shapes">
                        <div class="shape"></div>
                        <div class="shape"></div>
                        <div class="shape"></div>
                    </div>
                    <div class="hero-3d-container" id="hero3D"></div>
                    <div class="hero-content">
                        <h1 class="hero-title">${window.i18n ? window.i18n.t('masterNewSkills') : 'Master New Skills'}</h1>
                        <p class="hero-subtitle">${window.i18n ? window.i18n.t('transformKnowledge') : 'Transform your knowledge with our comprehensive courses'}</p>
                        <div class="hero-cta">
                            <button class="hero-btn hero-btn-primary" onclick="scrollToCourses()">${window.i18n ? window.i18n.t('exploreCourses') : 'Explore Courses'}</button>
                            ${user ? `
                                <button class="hero-btn" onclick="scrollToCourses()">${window.i18n ? (window.i18n.t('continueLearning') || 'Continue Learning') : 'Continue Learning'}</button>
                            ` : `
                                <button class="hero-btn" onclick="openLoginModal()">${window.i18n ? window.i18n.t('getStarted') : 'Get Started'}</button>
                            `}
                        </div>
                    </div>
                </div>
                ${coursesHTML}
            `;
            
            // Initialize 3D scene
            init3DScene();
        }

        // Initialize 3D scene for hero
        function init3DScene() {
            const container = document.getElementById('hero3D');
            if (!container || typeof THREE === 'undefined') {
                // Fallback if Three.js didn't load
                if (container) {
                    container.style.background = 'radial-gradient(circle at 50% 50%, rgba(255,255,255,0.1) 0%, transparent 70%)';
                }
                return;
            }

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // Create floating geometric shapes
            const geometries = [
                new THREE.IcosahedronGeometry(1, 0),
                new THREE.OctahedronGeometry(1, 0),
                new THREE.TetrahedronGeometry(1, 0)
            ];

            const shapes = [];
            geometries.forEach((geo, i) => {
                const material = new THREE.MeshStandardMaterial({
                    color: 0xffffff,
                    metalness: 0.7,
                    roughness: 0.3,
                    transparent: true,
                    opacity: 0.2
                });
                const mesh = new THREE.Mesh(geo, material);
                mesh.position.set(
                    (Math.random() - 0.5) * 10,
                    (Math.random() - 0.5) * 10,
                    (Math.random() - 0.5) * 10
                );
                mesh.rotation.set(
                    Math.random() * Math.PI,
                    Math.random() * Math.PI,
                    Math.random() * Math.PI
                );
                scene.add(mesh);
                shapes.push(mesh);
            });

            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            // Add directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);

            camera.position.z = 5;

            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                
                shapes.forEach((shape, i) => {
                    shape.rotation.x += 0.005 * (i + 1);
                    shape.rotation.y += 0.008 * (i + 1);
                    shape.position.y += Math.sin(Date.now() * 0.001 + i) * 0.01;
                });

                renderer.render(scene, camera);
            }

            animate();

            // Handle resize
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }

        function scrollToCourses() {
            const coursesSection = document.getElementById('coursesSection');
            if (coursesSection) {
                coursesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Load course
        function loadCourse(courseId) {
            const course = courses.find(c => c.id === courseId);
            if (!course) return;

            currentCourse = course;
            state.currentCourseId = courseId;
            state.currentModule = 1;
            state.totalModules = course.modules_data.length;

            renderCourseView();
            loadModule(1);
        }

        // Render course view
        function renderCourseView() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="container">
                    <aside class="sidebar">
                        <div class="sidebar-header">
                            <div class="course-title-sidebar">${currentCourse.title}</div>
                            <div class="sidebar-nav-item ${state.sidebarView === 'messages' ? 'active' : ''}" onclick="viewSidebarMessages()" style="margin-bottom: 1rem;">
                                <span class="sidebar-nav-item-icon">üí¨</span>
                                <span>Messages</span>
                            </div>
                            <div class="sidebar-nav-item ${state.sidebarView === 'assignments' ? 'active' : ''}" onclick="viewSidebarAssignments()" style="margin-bottom: 1rem;">
                                <span class="sidebar-nav-item-icon">üìù</span>
                                <span>Assignments</span>
                            </div>
                            <div style="border-top: 1px solid var(--border); padding-top: 1rem; margin-top: 0.5rem;">
                                <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.75rem; font-weight: 600;">Modules</div>
                            </div>
                        </div>
                        <ul class="module-list" id="moduleList">
                                ${currentCourse.modules_data.map((module, index) => {
                                    const isActive = module.id === state.currentModule && !state.sidebarView;
                                    const moduleKey = `${state.currentCourseId}-${module.id}`;
                                    const isCompleted = state.completedModules.includes(moduleKey);
                                    const hasQuiz = state.quizScores[moduleKey];
                                    
                                    return `
                                        <li class="module-item ${isActive ? 'active' : ''}" onclick="loadModule(${module.id})">
                                            <div class="module-number">Module ${module.id}</div>
                                            <div class="module-name">${module.title}</div>
                                            <div class="module-status">
                                                ${isCompleted ? '<span class="status-badge status-completed">‚úì Completed</span>' : ''}
                                                ${hasQuiz ? `<span class="status-badge status-in-progress">Quiz: ${hasQuiz.score}/${hasQuiz.total}</span>` : ''}
                                            </div>
                                        </li>
                                    `;
                                }).join('')}
                        </ul>
                    </aside>

                    <main class="content-area">
                        <div id="content">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Loading module...</p>
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        // Load module content
        async function loadModule(moduleId) {
            state.currentModule = moduleId;
            state.sidebarView = null; // Clear sidebar view when loading module
            renderCourseView();
            
            const contentArea = document.getElementById('content');
            contentArea.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading module...</p></div>';

            try {
                const module = currentCourse.modules_data[moduleId - 1];
                // Determine course directory based on courseId
                let courseDir = 'course';
                if (state.currentCourseId === 'personal-finance') {
                    courseDir = 'course-finance';
                } else if (state.currentCourseId === 'ios-app-development') {
                    courseDir = 'course-ios';
                } else if (state.currentCourseId === 'vibecoding') {
                    courseDir = 'course-vibecoding';
                } else if (state.currentCourseId === 'human-minds') {
                    courseDir = 'course-minds';
                } else if (state.currentCourseId === 'sign-language') {
                    courseDir = 'course-signlanguage';
                }
                const response = await fetch(`${courseDir}/modules/module${String(moduleId).padStart(2, '0')}.md`);
                
                if (!response.ok) {
                    throw new Error('Module not found');
                }

                const markdown = await response.text();
                let html = marked.parse(markdown);

                // Process markdown to hide answers and make resources clickable
                html = processModuleContent(html, moduleId);

                contentArea.innerHTML = `
                    <div class="module-header">
                        <h1 class="module-title">${module.title}</h1>
                        <p class="module-subtitle">${module.subtitle}</p>
                        <div class="module-actions">
                            <button class="btn btn-primary" onclick="startQuiz(${moduleId})">Take Quiz</button>
                            <button class="btn btn-secondary" onclick="downloadModule(${moduleId})">Download PDF</button>
                        </div>
                    </div>
                    <div class="module-content">${html}</div>
                    <div class="nav-buttons">
                        ${moduleId > 1 ? `<button class="btn btn-secondary" onclick="loadModule(${moduleId - 1})">‚Üê Previous Module</button>` : '<div></div>'}
                        ${moduleId < state.totalModules ? `<button class="btn btn-primary" onclick="loadModule(${moduleId + 1})">Next Module ‚Üí</button>` : '<button class="btn btn-success" onclick="completeCourse()">Complete Course ‚úì</button>'}
                    </div>
                `;

                // Highlight code blocks
                document.querySelectorAll('pre code').forEach(block => {
                    hljs.highlightElement(block);
                });

                updateProgress();
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="module-header">
                        <h1 class="module-title">Error Loading Module</h1>
                    </div>
                    <p>Could not load module content. Please check that the file exists.</p>
                    <p style="color: var(--text-light); margin-top: 1rem;">Error: ${error.message}</p>
                `;
            }
        }

        // Process module content
        function processModuleContent(html, moduleId) {
            html = html.replace(/‚úì/g, '');
            html = html.replace(/\(Answer:.*?\)/gi, '');
            html = html.replace(/("Basics of Arguments"|"Introduction to Propositional Logic"|PDF|worksheet|template|cheat sheet)/gi, 
                '<a href="#" class="resource-link" onclick="downloadResource(\'$1\')">üìÑ $1</a>');
            return html;
        }

        // Quiz functionality
        async function startQuiz(moduleId) {
            try {
                // Determine course directory based on courseId
                let courseDir = 'course';
                if (state.currentCourseId === 'personal-finance') {
                    courseDir = 'course-finance';
                } else if (state.currentCourseId === 'ios-app-development') {
                    courseDir = 'course-ios';
                } else if (state.currentCourseId === 'vibecoding') {
                    courseDir = 'course-vibecoding';
                } else if (state.currentCourseId === 'human-minds') {
                    courseDir = 'course-minds';
                } else if (state.currentCourseId === 'sign-language') {
                    courseDir = 'course-signlanguage';
                }
                const response = await fetch(`${courseDir}/quizzes/quiz${moduleId}.json`);
                if (!response.ok) {
                    alert('Quiz not available for this module yet.');
                    return;
                }
                
                currentQuiz = await response.json();
                quizAnswers = {};
                
                const moduleKey = `${state.currentCourseId}-${moduleId}`;
                
                const quizHTML = `
                    <div class="quiz-container">
                        <div class="quiz-header">
                            <h2 class="quiz-title">${currentQuiz.module} - Quiz</h2>
                            <span style="color: var(--text-light);">${currentQuiz.questions.length} questions</span>
                        </div>
                        ${currentQuiz.questions.map((q, idx) => {
                            if (q.type === 'multiple_choice') {
                                return `
                                    <div class="quiz-question">
                                        <div class="question-text">${idx + 1}. ${q.question}</div>
                                        <div class="quiz-options">
                                            ${q.options.map((opt, optIdx) => `
                                                <div class="quiz-option" onclick="selectAnswer(${idx}, ${optIdx})" id="q${idx}_opt${optIdx}">
                                                    ${String.fromCharCode(65 + optIdx)}) ${opt}
                                                </div>
                                            `).join('')}
                                        </div>
                                        <div class="quiz-explanation" id="explanation_${idx}">
                                            <strong>Explanation:</strong> ${q.explanation}
                                        </div>
                                    </div>
                                `;
                            } else {
                                return `
                                    <div class="quiz-question">
                                        <div class="question-text">${idx + 1}. ${q.question}</div>
                                        <input type="text" class="short-answer-input" id="answer_${idx}" placeholder="Type your answer here">
                                        <div class="quiz-explanation" id="explanation_${idx}">
                                            <strong>Explanation:</strong> ${q.explanation}
                                        </div>
                                    </div>
                                `;
                            }
                        }).join('')}
                        <div class="quiz-actions">
                            <button class="btn btn-primary" onclick="submitQuiz(${moduleId})">Submit Quiz</button>
                            <button class="btn btn-secondary" onclick="loadModule(${moduleId})">Cancel</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('content').innerHTML = quizHTML;
            } catch (error) {
                alert('Error loading quiz: ' + error.message);
            }
        }

        function selectAnswer(questionIdx, optionIdx) {
            const question = currentQuiz.questions[questionIdx];
            if (question.type !== 'multiple_choice') return;
            
            document.querySelectorAll(`#q${questionIdx}_opt${optionIdx}`).forEach(el => {
                el.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
            });
            
            const selectedOption = document.getElementById(`q${questionIdx}_opt${optionIdx}`);
            selectedOption.classList.add('selected');
            quizAnswers[questionIdx] = optionIdx;
        }

        async function submitQuiz(moduleId) {
            if (!currentQuiz) return;
            
            let score = 0;
            const total = currentQuiz.questions.length;
            const moduleKey = `${state.currentCourseId}-${moduleId}`;
            
            currentQuiz.questions.forEach((q, idx) => {
                const explanation = document.getElementById(`explanation_${idx}`);
                explanation.classList.add('show');
                
                if (q.type === 'multiple_choice') {
                    const selected = quizAnswers[idx];
                    const correct = q.correct_answer;
                    const optionEl = document.getElementById(`q${idx}_opt${selected}`);
                    
                    if (selected === correct) {
                        score++;
                        if (optionEl) {
                            optionEl.classList.add('correct');
                        }
                    } else {
                        if (optionEl) {
                            optionEl.classList.add('incorrect');
                        }
                        const correctEl = document.getElementById(`q${idx}_opt${correct}`);
                        if (correctEl) {
                            correctEl.classList.add('correct');
                        }
                    }
                } else {
                    const answer = document.getElementById(`answer_${idx}`).value.toLowerCase().trim();
                    const acceptable = q.acceptable_answers.map(a => a.toLowerCase().trim());
                    if (acceptable.some(a => answer.includes(a) || a.includes(answer))) {
                        score++;
                    }
                }
            });
            
            state.quizScores[moduleKey] = { score, total };
            localStorage.setItem('quizScores', JSON.stringify(state.quizScores));
            
            const passed = score >= currentQuiz.passing_score;
            const scoreHTML = `
                <div class="quiz-score ${passed ? 'score-pass' : 'score-fail'}">
                    ${passed ? '‚úì ' : '‚úó '}You scored ${score}/${total} 
                    ${passed ? '- Passed!' : `- Need ${currentQuiz.passing_score} to pass`}
                </div>
            `;
            
            document.querySelector('.quiz-container').insertAdjacentHTML('beforeend', scoreHTML);
            renderCourseView();
            loadModule(moduleId);
        }

        function downloadResource(resourceName) {
            alert(`Downloading ${resourceName}...\n(Resource files will be available in the resources folder)`);
        }

        async function downloadModule(moduleId) {
            const module = currentCourse.modules_data[moduleId - 1];
            
            try {
                // Determine course directory based on courseId
                let courseDir = 'course';
                if (state.currentCourseId === 'personal-finance') {
                    courseDir = 'course-finance';
                } else if (state.currentCourseId === 'ios-app-development') {
                    courseDir = 'course-ios';
                } else if (state.currentCourseId === 'vibecoding') {
                    courseDir = 'course-vibecoding';
                }
                // Try to fetch the module markdown file
                const response = await fetch(`${courseDir}/modules/module${String(moduleId).padStart(2, '0')}.md`);
                if (!response.ok) {
                    throw new Error('Module file not found');
                }
                
                const markdown = await response.text();
                
                // Create a printable HTML document
                const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${module.title} - ${currentCourse.title}</title>
    <style>
        @media print {
            @page {
                margin: 2cm;
            }
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
                color: #333;
            }
            h1 { color: #2d3748; border-bottom: 2px solid #667eea; padding-bottom: 0.5rem; }
            h2 { color: #667eea; margin-top: 1.5rem; }
            h3 { color: #764ba2; margin-top: 1rem; }
            code {
                background: #f7fafc;
                padding: 0.2rem 0.4rem;
                border-radius: 3px;
                font-family: 'Courier New', monospace;
            }
            pre {
                background: #f7fafc;
                padding: 1rem;
                border-radius: 5px;
                overflow-x: auto;
            }
        }
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
            color: #333;
        }
        h1 { color: #2d3748; border-bottom: 2px solid #667eea; padding-bottom: 0.5rem; }
        h2 { color: #667eea; margin-top: 1.5rem; }
        h3 { color: #764ba2; margin-top: 1rem; }
        code {
            background: #f7fafc;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        pre {
            background: #f7fafc;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>${module.title}</h1>
    <p><strong>Course:</strong> ${currentCourse.title}</p>
    <p><strong>Module ${moduleId}</strong></p>
    <hr>
    ${marked.parse(markdown)}
</body>
</html>
                `;
                
                // Create a blob and download it
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${module.title.replace(/[^a-z0-9]/gi, '_')}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Also open print dialog for PDF option
                const printWindow = window.open('', '_blank');
                printWindow.document.write(htmlContent);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.print();
                    // Close after a delay
                    setTimeout(() => printWindow.close(), 1000);
                }, 250);
                
            } catch (error) {
                console.error('Error downloading module:', error);
                // Fallback: Open print dialog for current page
                alert(`Opening print dialog for ${module.title}...\n\nIn the print dialog, select "Save as PDF" to download as PDF.`);
                window.print();
            }
        }

        function completeCourse() {
            const moduleKey = `${state.currentCourseId}-${state.currentModule}`;
            if (!state.completedModules.includes(moduleKey)) {
                state.completedModules.push(moduleKey);
                localStorage.setItem('completedModules', JSON.stringify(state.completedModules));
            }
            
            // Check if course is fully completed and generate certificate
            if (CertificateManager.checkCourseCompletion(state.currentCourseId)) {
                const existingCert = CertificateManager.getCertificatesForUser().find(
                    cert => cert.courseId === state.currentCourseId
                );
                
                if (!existingCert) {
                    const certificate = CertificateManager.generateCertificate(
                        state.currentCourseId,
                        currentCourse.title
                    );
                    alert(`üéâ Congratulations! You have completed "${currentCourse.title}"!\n\nYour certificate has been generated and is available in your profile.`);
                } else {
                    alert('üéâ Congratulations! You have completed this course!\n\nYour certificate is available in your profile.');
                }
            } else {
                alert('üéâ Great progress! Complete all modules and pass all quizzes to earn your certificate.');
            }
        }

        function updateProgress() {
            // Progress tracking can be added here
        }

        // User Management
        function updateUserDisplay() {
            const container = document.getElementById('userProfileContainer');
            if (user) {
                container.innerHTML = `
                    <div class="user-profile" onclick="toggleProfileDropdown()">
                        <div class="user-avatar" id="userAvatar">${user.name.charAt(0).toUpperCase()}</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">${user.name}</div>
                            <div class="user-email" id="userEmail">${user.email}</div>
                        </div>
                        <div class="profile-dropdown" id="profileDropdown">
                            <div class="profile-dropdown-item" onclick="viewMyProfile()">My Profile</div>
                            <div class="profile-dropdown-item" onclick="openProfileEditModal()">Edit Profile</div>
                            <div class="profile-dropdown-item" onclick="viewCertificates()">My Certificates</div>
                            <div class="profile-dropdown-item" onclick="toggleProfileDropdown(); setTimeout(() => { if(typeof window.openMessaging === 'function') window.openMessaging(); else console.error('openMessaging not available'); }, 50);">Messages</div>
                            <div class="profile-dropdown-item" onclick="toggleProfileDropdown(); setTimeout(() => { if(typeof window.openAssignments === 'function') window.openAssignments(); else console.error('openAssignments not available'); }, 50);">Assignments</div>
                            <div class="profile-dropdown-item" onclick="openFriendsModal()">Friends</div>
                            <div class="profile-dropdown-item" onclick="openGDPRSettings()">GDPR & Data</div>
                            <div class="profile-dropdown-item" onclick="logout()">Sign Out</div>
                        </div>
                    </div>
                `;
            } else {
                showSignInButton();
            }
        }

        function showSignInButton() {
            const container = document.getElementById('userProfileContainer');
            container.innerHTML = `
                <button class="btn btn-secondary" onclick="openLoginModal()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.5rem 1rem; white-space: nowrap;">
                    Sign In
                </button>
            `;
        }

        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }

        function openProfileModal() {
            document.getElementById('profileModal').classList.add('show');
            document.getElementById('profileName').value = user.name;
            document.getElementById('profileEmail').value = user.email;
            document.getElementById('profileDropdown').classList.remove('show');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('show');
        }

        function logout() {
            user = null;
            localStorage.removeItem('user');
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
            showSignInButton();
            if (state.currentCourseId) {
                renderCourseView();
            }
        }

        function viewCertificates() {
            const modal = document.getElementById('certificatesModal');
            if (!modal) {
                const modalHTML = `
                    <div id="certificatesModal" class="modal">
                        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
                            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h2 class="modal-title">My Certificates</h2>
                                    <p style="color: var(--text-light); margin-top: 0.5rem;">Your earned certificates and achievements</p>
                                </div>
                                <button onclick="closeCertificatesModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
                            </div>
                            <div id="certificatesContent"></div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            }
            
            document.getElementById('certificatesContent').innerHTML = CertificateManager.renderCertificatesModal();
            document.getElementById('certificatesModal').classList.add('show');
            
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        }
        
        function closeCertificatesModal() {
            document.getElementById('certificatesModal').classList.remove('show');
        }
        
        function openProfileEditModal() {
            const modal = document.getElementById('profileEditModal');
            if (!modal) {
                const modalHTML = `
                    <div id="profileEditModal" class="modal">
                        <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
                            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                                <h2 class="modal-title">Edit Profile</h2>
                                <button onclick="closeProfileEditModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
                            </div>
                            <div id="profileEditContent"></div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            }
            
            document.getElementById('profileEditContent').innerHTML = UserProfileManager.renderEditProfileModal();
            document.getElementById('profileEditModal').classList.add('show');
            
            // Add character counter for bio
            setTimeout(() => {
                const bioInput = document.getElementById('profileBioInput');
                const bioCounter = document.getElementById('bioCharCount');
                if (bioInput && bioCounter) {
                    bioInput.addEventListener('input', function() {
                        bioCounter.textContent = this.value.length;
                        if (this.value.length > 450) {
                            bioCounter.style.color = 'var(--warning)';
                        } else {
                            bioCounter.style.color = 'var(--text-light)';
                        }
                    });
                }
            }, 100);
            
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        }
        
        function closeProfileEditModal() {
            document.getElementById('profileEditModal').classList.remove('show');
        }
        
        function viewMyProfile() {
            viewUserProfile(user.email);
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        }
        
        function openFriendsModal() {
            const modal = document.getElementById('friendsModal');
            if (!modal) {
                const modalHTML = `
                    <div id="friendsModal" class="modal">
                        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
                            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                                <h2 class="modal-title">Friends</h2>
                                <button onclick="closeFriendsModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
                            </div>
                            <div id="friendsContent"></div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            }
            
            // Render friends modal using UserProfileManager
            const friendsContent = document.getElementById('friendsContent');
            if (friendsContent && typeof UserProfileManager !== 'undefined' && UserProfileManager.renderFriendsModal) {
                friendsContent.innerHTML = UserProfileManager.renderFriendsModal();
            } else if (typeof renderFriendsModal === 'function') {
                renderFriendsModal();
            } else {
                friendsContent.innerHTML = '<p>Loading friends...</p>';
            }
            document.getElementById('friendsModal').classList.add('show');
            
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        }
        
        function closeFriendsModal() {
            document.getElementById('friendsModal').classList.remove('show');
        }
        
        // Sidebar navigation functions
        function viewSidebarMessages() {
            if (!user) {
                alert('Please sign in to view messages');
                return;
            }
            
            // Use the messaging system modal instead of sidebar view
            if (typeof window.openMessaging === 'function') {
                window.openMessaging();
            } else {
                alert('Messaging system not available. Please refresh the page.');
            }
            
            // Keep sidebar view state for UI consistency
            state.sidebarView = 'messages';
            renderCourseView();
            
            // Get all conversations - check if messaging system exists
            let allConversations = [];
            const currentUserEmail = user.email;
            
            // Try to get messages from messaging system
            if (typeof window.MessagingSystem !== 'undefined' && window.MessagingSystem.getConversations) {
                allConversations = window.MessagingSystem.getConversations(currentUserEmail);
            } else {
                // Fallback: check localStorage directly
                const messages = JSON.parse(localStorage.getItem('messages') || '{}');
                Object.keys(messages).forEach(conversationId => {
                    const [user1, user2] = conversationId.split('_');
                    if (user1 === currentUserEmail || user2 === currentUserEmail) {
                        const otherUserEmail = user1 === currentUserEmail ? user2 : user1;
                        const otherUser = UserProfileManager ? UserProfileManager.getProfile(otherUserEmail) : { name: otherUserEmail.split('@')[0], email: otherUserEmail };
                        const conversationMessages = messages[conversationId] || [];
                        const lastMessage = conversationMessages[conversationMessages.length - 1];
                        
                        allConversations.push({
                            friendEmail: otherUserEmail,
                            friendName: otherUser.name || otherUserEmail.split('@')[0],
                            lastMessage: lastMessage ? lastMessage.text : 'No messages yet',
                            lastMessageTime: lastMessage ? lastMessage.timestamp : null,
                            unreadCount: 0
                        });
                    }
                });
            }
            
            // Sort by last message time
            allConversations.sort((a, b) => {
                if (!a.lastMessageTime) return 1;
                if (!b.lastMessageTime) return -1;
                return new Date(b.lastMessageTime) - new Date(a.lastMessageTime);
            });
            
            const contentArea = document.getElementById('content');
            contentArea.innerHTML = `
                <div class="module-header">
                    <h1 class="module-title">üí¨ Messages</h1>
                    <p class="module-subtitle">Your conversations</p>
                </div>
                <div class="module-content">
                    ${allConversations.length > 0 ? `
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            ${allConversations.map(conv => `
                                <div class="friend-card" style="cursor: pointer; padding: 1rem; border: 1px solid var(--border); border-radius: 8px;" onclick="if(typeof window.openMessaging === 'function') { window.openMessaging('${conv.friendEmail}'); } else { alert('Messaging system not available'); }">
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <div class="friend-avatar">${conv.friendName.charAt(0).toUpperCase()}</div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">${conv.friendName}</div>
                                            <div style="font-size: 0.875rem; color: var(--text-light);">${conv.lastMessage.substring(0, 50)}${conv.lastMessage.length > 50 ? '...' : ''}</div>
                                        </div>
                                        ${conv.lastMessageTime ? `<div style="font-size: 0.75rem; color: var(--text-light);">${new Date(conv.lastMessageTime).toLocaleDateString()}</div>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 3rem; color: var(--text-light);">
                            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">No messages yet</p>
                            <p>Start a conversation by messaging a friend from your Friends list!</p>
                        </div>
                    `}
                </div>
            `;
        }

        function viewSidebarAssignments() {
            if (!user) {
                alert('Please sign in to view assignments');
                return;
            }
            
            if (!state.currentCourseId) {
                alert('Please select a course first');
                return;
            }
            
            state.sidebarView = 'assignments';
            renderCourseView();
            
            // Get assignments from modules
            const assignments = [];
            currentCourse.modules_data.forEach((module, index) => {
                const moduleKey = `${state.currentCourseId}-${module.id}`;
                const isCompleted = state.completedModules.includes(moduleKey);
                
                assignments.push({
                    moduleId: module.id,
                    moduleTitle: module.title,
                    title: `Module ${module.id} Assignment`,
                    description: `Complete the assignment for ${module.title}`,
                    dueDate: null,
                    status: isCompleted ? 'completed' : 'pending',
                    moduleKey: moduleKey
                });
            });
            
            const contentArea = document.getElementById('content');
            contentArea.innerHTML = `
                <div class="module-header">
                    <h1 class="module-title">üìù Assignments</h1>
                    <p class="module-subtitle">Your course assignments</p>
                </div>
                <div class="module-content">
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        ${assignments.map(assignment => `
                            <div class="friend-card" style="padding: 1.5rem; border: 1px solid var(--border); border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                    <div>
                                        <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">${assignment.title}</h3>
                                        <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">${assignment.description}</p>
                                    </div>
                                    <span class="status-badge ${assignment.status === 'completed' ? 'status-completed' : 'status-in-progress'}" style="white-space: nowrap;">
                                        ${assignment.status === 'completed' ? '‚úì Completed' : 'Pending'}
                                    </span>
                                </div>
                                <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                                    <button class="btn btn-primary" onclick="loadModule(${assignment.moduleId})" style="flex: 1;">
                                        ${assignment.status === 'completed' ? 'Review Module' : 'Start Assignment'}
                                    </button>
                                    ${assignment.status === 'completed' ? `
                                        <button class="btn btn-secondary" onclick="viewCertificate('${assignment.moduleKey}')" style="flex: 1;">
                                            View Certificate
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function viewCertificate(certId) {
            const certificate = CertificateManager.getCertificateById(certId);
            if (!certificate) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 class="modal-title">Certificate</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
                    </div>
                    ${CertificateManager.renderCertificateHTML(certificate)}
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        window.viewCertificates = viewCertificates;
        window.closeCertificatesModal = closeCertificatesModal;
        window.openProfileEditModal = openProfileEditModal;
        window.closeProfileEditModal = closeProfileEditModal;
        window.viewMyProfile = viewMyProfile;
        window.openFriendsModal = openFriendsModal;
        window.closeFriendsModal = closeFriendsModal;
        window.viewCertificate = viewCertificate;
        window.viewSidebarMessages = viewSidebarMessages;
        window.viewSidebarAssignments = viewSidebarAssignments;
        window.openGDPRSettings = openGDPRSettings;
        window.closeGDPRSettings = closeGDPRSettings;

        // Universal modal close function
        function closeModal(modalElement) {
            if (!modalElement) return;
            
            // Handle different modal types
            const modalId = modalElement.id;
            
            if (modalId === 'settingsModal') {
                if (typeof closeSettings === 'function') {
                    closeSettings();
                    return;
                }
            } else if (modalId === 'assignmentsModal') {
                if (typeof closeAssignments === 'function') {
                    closeAssignments();
                    return;
                }
            } else if (modalId === 'messagingModal') {
                if (typeof closeMessaging === 'function') {
                    closeMessaging();
                    return;
                }
            } else if (modalId === 'friendsModal') {
                if (typeof closeFriendsModal === 'function') {
                    closeFriendsModal();
                    return;
                }
            } else if (modalId === 'profileEditModal') {
                if (typeof closeProfileEditModal === 'function') {
                    closeProfileEditModal();
                    return;
                }
            } else if (modalId === 'course-details-modal') {
                // 3D world course details modal - remove it
                modalElement.remove();
                return;
            } else if (modalId === 'predictionModal') {
                if (typeof closePrediction === 'function') {
                    closePrediction();
                    return;
                }
            } else if (modalId === 'aiSearchModal') {
                if (typeof closeAISearch === 'function') {
                    closeAISearch();
                    return;
                }
            }
            
            // Default: just remove show class
            modalElement.classList.remove('show');
        }
        
        // Add click-outside-to-close functionality to all modals
        document.addEventListener('click', function(e) {
            const modals = document.querySelectorAll('.modal.show');
            modals.forEach(modal => {
                // Check if click is on the backdrop (modal itself, not modal-content)
                if (e.target === modal) {
                    closeModal(modal);
                }
            });
        });
        
        // Improve ESC key handler
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const activeElement = document.activeElement;
                const isInputFocused = activeElement && (
                    activeElement.tagName === 'INPUT' ||
                    activeElement.tagName === 'TEXTAREA' ||
                    activeElement.isContentEditable
                );
                
                // Only close if not typing in an input field
                if (!isInputFocused) {
                    // Check for specific modals first
                    const aiSearchModal = document.getElementById('aiSearchModal');
                    if (aiSearchModal && aiSearchModal.classList.contains('show')) {
                        if (typeof closeAISearch === 'function') {
                            closeAISearch();
                            return;
                        }
                    }
                    
                    const predictionModal = document.getElementById('predictionModal');
                    if (predictionModal && predictionModal.classList.contains('show')) {
                        if (typeof closePrediction === 'function') {
                            closePrediction();
                            return;
                        }
                    }
                    
                    const settingsModal = document.getElementById('settingsModal');
                    if (settingsModal && settingsModal.classList.contains('show')) {
                        if (typeof closeSettings === 'function') {
                            closeSettings();
                            return;
                        }
                    }
                    
                    // Fallback: close any other modals
                    const modals = document.querySelectorAll('.modal.show');
                    if (modals.length > 0) {
                        // Close the topmost modal (last one in DOM order)
                        const topModal = modals[modals.length - 1];
                        closeModal(topModal);
                    }
                    
                    // Also close any dropdowns
                    const dropdown = document.getElementById('profileDropdown');
                    if (dropdown) {
                        dropdown.classList.remove('show');
                    }
                }
            }
        });

        function openLoginModal() {
            document.getElementById('loginModal').classList.add('show');
        }

        // Simple password-based authentication (client-side only)
        function hashPassword(password) {
            // Simple hash for demo purposes (not secure for production)
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }

        function showSignUpForm() {
            const form = document.getElementById('loginForm');
            const submitBtn = form.querySelector('button[type="submit"]');
            const signUpLink = form.querySelector('a');
            
            form.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="signupName" placeholder="Enter your name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="signupEmail" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="signupPassword" placeholder="Create a password" required minlength="6">
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="showLoginForm()">Back to Sign In</button>
                    <button type="submit" class="btn btn-primary">Create Account</button>
                </div>
            `;
            
            form.onsubmit = (e) => {
                e.preventDefault();
                const name = document.getElementById('signupName').value.trim();
                const email = document.getElementById('signupEmail').value.trim().toLowerCase();
                const password = document.getElementById('signupPassword').value;
                
                if (password.length < 6) {
                    alert('Password must be at least 6 characters');
                    return;
                }
                
                const emailValidation = SecurityUtils.validateEmail(email);
                if (!emailValidation.valid) {
                    SecurityUtils.showError(emailValidation.error);
                    return;
                }
                
                // Check if user already exists
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                if (users[email]) {
                    alert('An account with this email already exists. Please sign in instead.');
                    showLoginForm();
                    return;
                }
                
                // Try Supabase first if configured
                const supabaseUrl = localStorage.getItem('supabase_url');
                const supabaseKey = localStorage.getItem('supabase_anon_key');
                
                if (supabaseUrl && supabaseKey && typeof SupabaseManager !== 'undefined') {
                    // Use Supabase authentication
                    SupabaseManager.init().then(async () => {
                        try {
                            const { data, error } = await SupabaseManager.signUp(emailValidation.email, password, name);
                            if (error) throw error;
                            
                            // Get profile
                            const profile = await SupabaseManager.getProfile(data.user.id);
                            user = { ...data.user, ...profile };
                            
                            // Send welcome email if backend is configured
                            const backendUrl = localStorage.getItem('backend_url');
                            if (backendUrl) {
                                fetch(`${backendUrl}/api/notifications/welcome`, {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ email: user.email, name: user.name })
                                }).catch(err => console.log('Welcome email failed:', err));
                            }
                            
                            document.getElementById('loginModal').classList.remove('show');
                            updateUserDisplay();
                            if (state.currentCourseId) {
                                renderCourseView();
                            }
                        } catch (error) {
                            console.error('Supabase signup error:', error);
                            alert(error.message || 'Sign up failed. Please try again.');
                        }
                    });
                } else {
                    // Fallback: localStorage authentication
                    users[email] = {
                        name: name,
                        email: emailValidation.email,
                        passwordHash: hashPassword(password)
                    };
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // Auto sign in
                    user = { name: name, email: emailValidation.email };
                    localStorage.setItem('user', JSON.stringify(user));
                    
                    if (UserProfileManager && typeof UserProfileManager.initDefaultFriends === 'function') {
                        UserProfileManager.initDefaultFriends();
                    }
                    
                    document.getElementById('loginModal').classList.remove('show');
                    updateUserDisplay();
                    if (state.currentCourseId) {
                        renderCourseView();
                    }
                }
            };
        }

        function showLoginForm() {
            const form = document.getElementById('loginForm');
            form.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Email or Username</label>
                    <input type="text" class="form-input" id="loginEmail" placeholder="Enter your email or username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required autocomplete="current-password">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Sign In</button>
                </div>
                <p style="text-align: center; margin-top: 1rem; font-size: 0.875rem; color: var(--text-light);">
                    Don't have an account? <a href="#" onclick="event.preventDefault(); showSignUpForm();" style="color: var(--theme-primary);">Sign up</a>
                </p>
            `;
            
            form.onsubmit = async (e) => {
                e.preventDefault();
                const emailOrUsername = document.getElementById('loginEmail').value.trim().toLowerCase();
                const password = document.getElementById('loginPassword').value;
                
                // Try Supabase first if configured
                const supabaseUrl = localStorage.getItem('supabase_url');
                const supabaseKey = localStorage.getItem('supabase_anon_key');
                
                if (supabaseUrl && supabaseKey && typeof SupabaseManager !== 'undefined') {
                    // Use Supabase authentication
                    try {
                        await SupabaseManager.init();
                        const { data, error } = await SupabaseManager.signIn(emailOrUsername, password);
                        if (error) throw error;
                        
                        // Get profile
                        const profile = await SupabaseManager.getProfile(data.user.id);
                        user = { ...data.user, ...profile };
                        
                        document.getElementById('loginModal').classList.remove('show');
                        updateUserDisplay();
                        if (state.currentCourseId) {
                            renderCourseView();
                        }
                        return;
                    } catch (error) {
                        console.error('Supabase login error:', error);
                        alert(error.message || 'Login failed. Please check your credentials.');
                        return;
                    }
                }
                
                // Fallback: localStorage authentication
                const isEmail = emailOrUsername.includes('@');
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                
                let userAccount = null;
                if (isEmail) {
                    userAccount = users[emailOrUsername];
                } else {
                    // First check if username exists directly
                    if (users[emailOrUsername]) {
                        userAccount = users[emailOrUsername];
                        userAccount.email = emailOrUsername.includes('@') ? emailOrUsername : users[emailOrUsername].email;
                    } else {
                        // Find by username/name
                        for (const email in users) {
                            if (users[email].name.toLowerCase() === emailOrUsername) {
                                userAccount = users[email];
                                userAccount.email = email;
                                break;
                            }
                        }
                    }
                }
                
                if (!userAccount) {
                    alert('Account not found. Please sign up first.');
                    showSignUpForm();
                    return;
                }
                
                if (userAccount.passwordHash !== hashPassword(password)) {
                    alert('Incorrect password. Please try again.');
                    return;
                }
                
                user = { 
                    name: userAccount.name, 
                    email: userAccount.email 
                };
                localStorage.setItem('user', JSON.stringify(user));
                
                if (UserProfileManager && typeof UserProfileManager.initDefaultFriends === 'function') {
                    UserProfileManager.initDefaultFriends();
                }
                
                document.getElementById('loginModal').classList.remove('show');
                updateUserDisplay();
                if (state.currentCourseId) {
                    renderCourseView();
                }
            };
        }

        // Make functions globally accessible
        window.showSignUpForm = showSignUpForm;
        window.showLoginForm = showLoginForm;
        
        // Initialize test account (for development/testing)
        function initTestAccount() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            // Create test account with username 'test' and password 'test'
            if (!users['test']) {
                // Simple hash function
                function hashPassword(password) {
                    let hash = 0;
                    for (let i = 0; i < password.length; i++) {
                        const char = password.charCodeAt(i);
                        hash = ((hash << 5) - hash) + char;
                        hash = hash & hash;
                    }
                    return hash.toString();
                }
                
                const testPasswordHash = hashPassword('test');
                
                // Create test account
                users['test'] = {
                    name: 'Test User',
                    email: 'test@example.com',
                    passwordHash: testPasswordHash
                };
                
                localStorage.setItem('users', JSON.stringify(users));
            }
        }
        
        // Initialize test account on page load
        initTestAccount();
        
        // Make functions globally accessible
        window.showSignUpForm = showSignUpForm;
        window.showLoginForm = showLoginForm;
        
        // Initialize login form
        showLoginForm();

        // Profile Form
        document.getElementById('profileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            user.name = document.getElementById('profileName').value;
            user.email = document.getElementById('profileEmail').value;
            localStorage.setItem('user', JSON.stringify(user));
            updateUserDisplay();
            closeProfileModal();
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown && !e.target.closest('.user-profile')) {
                dropdown.classList.remove('show');
            }
        });

        // ESC key handler is now handled by the universal handler above (removed duplicate)

        // Make functions global
        window.showCourses = showCourses;
        window.loadCourse = loadCourse;
        window.loadModule = loadModule;
        window.startQuiz = startQuiz;
        window.selectAnswer = selectAnswer;
        window.submitQuiz = submitQuiz;
        window.downloadResource = downloadResource;
        window.downloadModule = downloadModule;
        window.completeCourse = completeCourse;
        window.toggleProfileDropdown = toggleProfileDropdown;
        window.openProfileModal = openProfileModal;
        window.closeProfileModal = closeProfileModal;
        window.logout = logout;
        window.viewCertificates = viewCertificates;
        window.openLoginModal = openLoginModal;
        window.toggleTheme = toggleTheme;
        
        // Unified Settings Modal
        window.openSettings = function() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const currentLanguage = localStorage.getItem('language') || 'en';
            
            // Ensure courses are shown first
            if (typeof showCourses === 'function') {
                showCourses();
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.id = 'settingsModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header" style="border-bottom: 1px solid var(--border); padding-bottom: 1rem; margin-bottom: 1.5rem;">
                        <h2 class="modal-title">‚öôÔ∏è Settings</h2>
                        <button onclick="closeSettings()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text);">&times;</button>
                    </div>
                    
                    <!-- Appearance Section -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text); display: flex; align-items: center; gap: 0.5rem;">
                            <span>üé®</span> Appearance
                        </h3>
                        
                        <!-- Dark/Light Mode Toggle -->
                        <div style="background: var(--hover-bg); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">Dark Mode</div>
                                    <div style="font-size: 0.875rem; color: var(--text-light);">Switch between light and dark theme</div>
                                </div>
                                <button onclick="toggleTheme(); updateSettingsModal();" 
                                        style="background: ${currentTheme === 'dark' ? 'var(--theme-primary)' : 'var(--border)'}; 
                                               border: none; width: 50px; height: 26px; border-radius: 13px; 
                                               cursor: pointer; position: relative; transition: background 0.3s;">
                                    <span style="position: absolute; ${currentTheme === 'dark' ? 'right: 3px;' : 'left: 3px;'} top: 3px; 
                                                width: 20px; height: 20px; background: white; border-radius: 50%; 
                                                transition: left 0.3s, right 0.3s;"></span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- View Mode Selector -->
                        <div style="margin-bottom: 2rem;">
                            <div style="font-weight: 600; margin-bottom: 0.75rem; font-size: 0.9rem;">View Mode</div>
                            <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 0.75rem;">Choose how courses are displayed</div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem;">
                                ${Object.entries(typeof ViewModeManager !== 'undefined' ? ViewModeManager.modes : {}).map(([key, mode]) => `
                                    <div onclick="ViewModeManager.setMode('${key}'); updateSettingsModal();" 
                                         style="padding: 1rem; border: 2px solid ${(typeof ViewModeManager !== 'undefined' && ViewModeManager.currentMode === key) ? 'var(--theme-primary)' : 'var(--border)'}; 
                                                border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;
                                                background: ${(typeof ViewModeManager !== 'undefined' && ViewModeManager.currentMode === key) ? 'var(--hover-bg)' : 'transparent'};"
                                         onmouseover="this.style.transform='scale(1.05)'" 
                                         onmouseout="this.style.transform='scale(1)'">
                                        <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">${mode.icon}</div>
                                        <div style="font-size: 0.75rem; font-weight: 600; color: var(--text);">${mode.name}</div>
                                        <div style="font-size: 0.65rem; color: var(--text-light); margin-top: 0.25rem;">${mode.description}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Color Theme Selector -->
                        <div style="margin-bottom: 1rem;">
                            <div style="font-weight: 600; margin-bottom: 0.75rem; font-size: 0.9rem;">Color Theme</div>
                            <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 0.75rem;">Choose colors and styling (works with any view mode)</div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 0.75rem;">
                                ${Object.entries(ThemeManager.themes).map(([key, theme]) => `
                                    <div onclick="ThemeManager.setTheme('${key}'); updateSettingsModal();" 
                                         style="padding: 1rem; border: 2px solid ${ThemeManager.currentTheme === key ? 'var(--theme-primary)' : 'var(--border)'}; 
                                                border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;
                                                background: ${ThemeManager.currentTheme === key ? 'var(--hover-bg)' : 'transparent'};"
                                         onmouseover="this.style.transform='scale(1.05)'" 
                                         onmouseout="this.style.transform='scale(1)'">
                                        <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">${theme.icon}</div>
                                        <div style="font-size: 0.75rem; font-weight: 600; color: var(--text);">${theme.name}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Layout Section -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text); display: flex; align-items: center; gap: 0.5rem;">
                            <span>üìê</span> Layout
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.75rem;">
                            ${Object.entries(UILayoutManager.layouts).map(([key, layout]) => `
                                <div onclick="UILayoutManager.setLayout('${key}'); updateSettingsModal(); showCourses();" 
                                     style="padding: 1rem; border: 2px solid ${UILayoutManager.currentLayout === key ? 'var(--theme-primary)' : 'var(--border)'}; 
                                            border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;
                                            background: ${UILayoutManager.currentLayout === key ? 'var(--hover-bg)' : 'transparent'};"
                                     onmouseover="this.style.transform='scale(1.05)'" 
                                     onmouseout="this.style.transform='scale(1)'">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">${layout.icon}</div>
                                    <div style="font-size: 0.75rem; font-weight: 600; color: var(--text); margin-bottom: 0.125rem;">${layout.name}</div>
                                    <div style="font-size: 0.65rem; color: var(--text-light);">${layout.description}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Language Section -->
                    <div>
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text); display: flex; align-items: center; gap: 0.5rem;">
                            <span>üåê</span> Language
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div onclick="setLanguage('en'); updateSettingsModal();" 
                                 style="padding: 1rem; border: 2px solid ${currentLanguage === 'en' ? 'var(--theme-primary)' : 'var(--border)'}; 
                                        border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 0.75rem;
                                        background: ${currentLanguage === 'en' ? 'var(--hover-bg)' : 'transparent'}; transition: all 0.2s;"
                                 onmouseover="this.style.background='var(--hover-bg)'" 
                                 onmouseout="this.style.background='${currentLanguage === 'en' ? 'var(--hover-bg)' : 'transparent'}'">
                                <span style="font-size: 1.5rem;">üá¨üáß</span>
                                <div>
                                    <div style="font-weight: 600; color: var(--text);">English</div>
                                    <div style="font-size: 0.75rem; color: var(--text-light);">English</div>
                                </div>
                                ${currentLanguage === 'en' ? '<span style="margin-left: auto; color: var(--theme-primary);">‚úì</span>' : ''}
                            </div>
                            <div onclick="setLanguage('el'); updateSettingsModal();" 
                                 style="padding: 1rem; border: 2px solid ${currentLanguage === 'el' ? 'var(--theme-primary)' : 'var(--border)'}; 
                                        border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 0.75rem;
                                        background: ${currentLanguage === 'el' ? 'var(--hover-bg)' : 'transparent'}; transition: all 0.2s;"
                                 onmouseover="this.style.background='var(--hover-bg)'" 
                                 onmouseout="this.style.background='${currentLanguage === 'el' ? 'var(--hover-bg)' : 'transparent'}'">
                                <span style="font-size: 1.5rem;">üá¨üá∑</span>
                                <div>
                                    <div style="font-weight: 600; color: var(--text);">ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</div>
                                    <div style="font-size: 0.75rem; color: var(--text-light);">Greek</div>
                                </div>
                                ${currentLanguage === 'el' ? '<span style="margin-left: auto; color: var(--theme-primary);">‚úì</span>' : ''}
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI API Keys Section -->
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text); display: flex; align-items: center; gap: 0.5rem;">
                            <span>ü§ñ</span> AI Configuration
                        </h3>
                        <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 1rem; padding: 0.75rem; background: var(--hover-bg); border-radius: 8px;">
                            ${typeof AIConfig !== 'undefined' && (AIConfig.groqApiKey || AIConfig.openaiApiKey) 
                                ? '<span style="color: var(--success);">‚úì API keys configured - AI features enabled</span>' 
                                : '<span style="color: var(--warning);">‚ö† No API keys configured - using fallback mode</span>'}
                        </div>
                        
                        <!-- Groq API Key -->
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text);">
                                Groq API Key (for AI Search & Chat)
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="password" id="groqApiKeyInput" 
                                       placeholder="gsk_..." 
                                       value="${typeof AIConfig !== 'undefined' && AIConfig.groqApiKey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : ''}"
                                       style="flex: 1; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text); font-family: monospace; font-size: 0.85rem;"
                                       oninput="document.getElementById('groqApiKeyStatus').textContent = ''">
                                <button onclick="saveGroqKey()" 
                                        style="padding: 0.75rem 1.5rem; background: var(--theme-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    Save
                                </button>
                            </div>
                            <div id="groqApiKeyStatus" style="margin-top: 0.5rem; font-size: 0.8rem;"></div>
                            <div style="margin-top: 0.25rem; font-size: 0.75rem; color: var(--text-light);">
                                Get free API key at <a href="https://console.groq.com" target="_blank" style="color: var(--theme-primary);">console.groq.com</a>
                            </div>
                        </div>
                        
                        <!-- OpenAI API Key -->
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text);">
                                OpenAI API Key (for AI Grading)
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="password" id="openaiApiKeyInput" 
                                       placeholder="sk-..." 
                                       value="${typeof AIConfig !== 'undefined' && AIConfig.openaiApiKey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : ''}"
                                       style="flex: 1; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text); font-family: monospace; font-size: 0.85rem;"
                                       oninput="document.getElementById('openaiApiKeyStatus').textContent = ''">
                                <button onclick="saveOpenAIKey()" 
                                        style="padding: 0.75rem 1.5rem; background: var(--theme-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    Save
                                </button>
                            </div>
                            <div id="openaiApiKeyStatus" style="margin-top: 0.5rem; font-size: 0.8rem;"></div>
                            <div style="margin-top: 0.25rem; font-size: 0.75rem; color: var(--text-light);">
                                Get API key at <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--theme-primary);">platform.openai.com</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Backend Configuration Section -->
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text); display: flex; align-items: center; gap: 0.5rem;">
                            <span>üîß</span> Backend Configuration
                        </h3>
                        <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 1rem; padding: 0.75rem; background: var(--hover-bg); border-radius: 8px;">
                            ${localStorage.getItem('backend_url') 
                                ? '<span style="color: var(--success);">‚úì Backend configured</span>' 
                                : '<span style="color: var(--warning);">‚ö† No backend configured - using fallback mode</span>'}
                            ${localStorage.getItem('supabase_url') && localStorage.getItem('supabase_anon_key')
                                ? '<br><span style="color: var(--success);">‚úì Supabase configured</span>' 
                                : '<br><span style="color: var(--warning);">‚ö† Supabase not configured - using localStorage</span>'}
                        </div>
                        
                        <!-- Backend URL -->
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text);">
                                Backend Server URL (for shared AI API keys)
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" id="backendUrlInput" 
                                       placeholder="https://your-backend.railway.app" 
                                       value="${localStorage.getItem('backend_url') || ''}"
                                       style="flex: 1; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text); font-size: 0.85rem;"
                                       oninput="document.getElementById('backendUrlStatus').textContent = ''">
                                <button onclick="saveBackendUrl()" 
                                        style="padding: 0.75rem 1.5rem; background: var(--theme-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    Save
                                </button>
                            </div>
                            <div id="backendUrlStatus" style="margin-top: 0.5rem; font-size: 0.8rem;"></div>
                            <div style="margin-top: 0.25rem; font-size: 0.75rem; color: var(--text-light);">
                                Deploy backend to Railway/Render and paste URL here. See <a href="https://github.com/philipposk/School/blob/main/IMPLEMENTATION_GUIDE.md" target="_blank" style="color: var(--theme-primary);">IMPLEMENTATION_GUIDE.md</a>
                            </div>
                        </div>
                        
                        <!-- Supabase Configuration -->
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text);">
                                Supabase URL
                            </label>
                            <input type="text" id="supabaseUrlInput" 
                                   placeholder="https://xxxxx.supabase.co" 
                                   value="${localStorage.getItem('supabase_url') || ''}"
                                   style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text); font-size: 0.85rem; margin-bottom: 0.5rem;"
                                   oninput="document.getElementById('supabaseStatus').textContent = ''">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text);">
                                Supabase Anon Key
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="password" id="supabaseKeyInput" 
                                       placeholder="eyJhbGc..." 
                                       value="${localStorage.getItem('supabase_anon_key') ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : ''}"
                                       style="flex: 1; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text); font-family: monospace; font-size: 0.85rem;"
                                       oninput="document.getElementById('supabaseStatus').textContent = ''">
                                <button onclick="saveSupabaseConfig()" 
                                        style="padding: 0.75rem 1.5rem; background: var(--theme-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    Save
                                </button>
                            </div>
                            <div id="supabaseStatus" style="margin-top: 0.5rem; font-size: 0.8rem;"></div>
                            <div style="margin-top: 0.25rem; font-size: 0.75rem; color: var(--text-light);">
                                Get credentials from Supabase Dashboard ‚Üí Settings ‚Üí API. See <a href="https://github.com/philipposk/School/blob/main/supabase-setup.md" target="_blank" style="color: var(--theme-primary);">supabase-setup.md</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing settings modal if any
            const existing = document.getElementById('settingsModal');
            if (existing) existing.remove();
            
            document.body.appendChild(modal);
            
            // Scroll window to center to ensure modal is visible
            // Since modals are fixed and centered, we need to scroll the page to show center area
            setTimeout(() => {
                const scrollPosition = window.scrollY;
                const viewportHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                
                // Calculate center position
                const centerPosition = (documentHeight - viewportHeight) / 2;
                
                // Only scroll if we're not already near the center
                if (Math.abs(scrollPosition - centerPosition) > viewportHeight / 4) {
                    window.scrollTo({ 
                        top: centerPosition, 
                        behavior: 'smooth' 
                    });
                }
            }, 150);
        };
        
        window.closeSettings = function() {
            const modal = document.getElementById('settingsModal');
            if (modal) modal.remove();
        };
        
        window.saveGroqKey = function() {
            const input = document.getElementById('groqApiKeyInput');
            const status = document.getElementById('groqApiKeyStatus');
            const key = input.value.trim();
            
            if (!key) {
                status.textContent = 'Please enter an API key';
                status.style.color = 'var(--error)';
                return;
            }
            
            if (typeof AIConfig !== 'undefined') {
                AIConfig.setGroqKey(key);
                status.textContent = '‚úì Groq API key saved successfully!';
                status.style.color = 'var(--success)';
                input.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                // Refresh the modal to show updated status
                setTimeout(() => {
                    const modal = document.getElementById('settingsModal');
                    if (modal) {
                        openSettings();
                    }
                }, 1000);
            } else {
                status.textContent = 'Error: AI config not loaded';
                status.style.color = 'var(--error)';
            }
        };
        
        window.saveOpenAIKey = function() {
            const input = document.getElementById('openaiApiKeyInput');
            const status = document.getElementById('openaiApiKeyStatus');
            const key = input.value.trim();
            
            if (!key) {
                status.textContent = 'Please enter an API key';
                status.style.color = 'var(--error)';
                return;
            }
            
            if (typeof AIConfig !== 'undefined') {
                AIConfig.setOpenAIKey(key);
                status.textContent = '‚úì OpenAI API key saved successfully!';
                status.style.color = 'var(--success)';
                input.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                // Refresh the modal to show updated status
                setTimeout(() => {
                    const modal = document.getElementById('settingsModal');
                    if (modal) {
                        openSettings();
                    }
                }, 1000);
            } else {
                status.textContent = 'Error: AI config not loaded';
                status.style.color = 'var(--error)';
            }
        };
        
        window.saveBackendUrl = function() {
            const input = document.getElementById('backendUrlInput');
            const status = document.getElementById('backendUrlStatus');
            const url = input.value.trim();
            
            if (!url) {
                status.textContent = 'Please enter a backend URL';
                status.style.color = 'var(--error)';
                return;
            }
            
            // Validate URL
            try {
                new URL(url);
            } catch (e) {
                status.textContent = 'Invalid URL format';
                status.style.color = 'var(--error)';
                return;
            }
            
            localStorage.setItem('backend_url', url);
            if (typeof AIConfig !== 'undefined') {
                AIConfig.setBackendUrl(url);
            }
            
            status.textContent = '‚úì Backend URL saved successfully!';
            status.style.color = 'var(--success)';
            
            // Test connection
            fetch(`${url}/health`)
                .then(res => res.json())
                .then(data => {
                    if (data.status === 'ok') {
                        status.textContent = '‚úì Backend URL saved and connected!';
                        status.style.color = 'var(--success)';
                    }
                })
                .catch(err => {
                    status.textContent = '‚ö† Saved but connection test failed. Check URL.';
                    status.style.color = 'var(--warning)';
                });
            
            setTimeout(() => {
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    openSettings();
                }
            }, 1500);
        };
        
        window.saveSupabaseConfig = function() {
            const urlInput = document.getElementById('supabaseUrlInput');
            const keyInput = document.getElementById('supabaseKeyInput');
            const status = document.getElementById('supabaseStatus');
            
            const url = urlInput.value.trim();
            const key = keyInput.value.trim();
            
            if (!url || !key) {
                status.textContent = 'Please enter both URL and key';
                status.style.color = 'var(--error)';
                return;
            }
            
            // Validate URL
            try {
                new URL(url);
            } catch (e) {
                status.textContent = 'Invalid URL format';
                status.style.color = 'var(--error)';
                return;
            }
            
            localStorage.setItem('supabase_url', url);
            localStorage.setItem('supabase_anon_key', key);
            
            // Update Supabase client if loaded
            if (typeof SupabaseManager !== 'undefined') {
                SupabaseManager.init();
            }
            
            status.textContent = '‚úì Supabase configuration saved!';
            status.style.color = 'var(--success)';
            keyInput.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            
            setTimeout(() => {
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    openSettings();
                }
            }, 1500);
        };
        
        window.setLanguage = function(lang) {
            if (window.i18n && (lang === 'en' || lang === 'el')) {
                window.i18n.setLanguage(lang);
                
                // Update logo text
                const logoText = document.getElementById('logoText');
                if (logoText) {
                    logoText.textContent = window.i18n.t('logo');
                }
                
                // Update header text if needed
                if (typeof updateUserDisplay === 'function') {
                    updateUserDisplay();
                }
                
                // Refresh courses view to show translated content
                if (state.currentCourseId === null) {
                    showCourses();
                } else {
                    // If viewing a course, reload it with new language
                    loadCourse(state.currentCourseId);
                }
                
                // Update settings modal if open
                const settingsModal = document.getElementById('settingsModal');
                if (settingsModal) {
                    updateSettingsModal();
                }
            }
        };
        
        window.updateSettingsModal = function() {
            // Update the modal to reflect current settings
            setTimeout(() => {
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    closeSettings();
                    openSettings();
                }
            }, 100);
        };
        
        // Keep individual functions for backward compatibility
        window.openThemeSelector = function() {
            openSettings();
        };
        
        window.openLayoutSelector = function() {
            openSettings();
        };
        
        window.showQuizzes = function() {
            alert('Quiz feature - showing all quizzes');
        };
        
        window.showProgress = function() {
            openPrediction();
        };

        // Chatbot functionality
        function toggleChatbot() {
            const window = document.getElementById('chatbotWindow');
            const bubble = document.getElementById('chatbotBubble');
            
            if (window.classList.contains('show')) {
                window.classList.remove('show');
                bubble.classList.remove('active');
            } else {
                window.classList.add('show');
                bubble.classList.add('active');
                document.getElementById('chatbotInput').focus();
            }
        }

        function handleChatbotKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatbotMessage();
            }
        }

        function sendChatbotMessage() {
            const input = document.getElementById('chatbotInput');
            const messages = document.getElementById('chatbotMessages');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'chatbot-message user';
            userMessage.innerHTML = `
                <div class="chatbot-avatar">üë§</div>
                <div class="chatbot-text">${escapeHtml(message)}</div>
            `;
            messages.appendChild(userMessage);
            messages.scrollTop = messages.scrollHeight;

            input.value = '';
            input.disabled = true;

            // Generate AI response (uses real AI API if available, otherwise intelligent fallback)
            input.disabled = true;
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'chatbot-message';
            typingIndicator.innerHTML = `
                <div class="chatbot-avatar">ü§ñ</div>
                <div class="chatbot-text" style="font-style: italic; color: var(--text-light);">Typing...</div>
            `;
            messages.appendChild(typingIndicator);
            messages.scrollTop = messages.scrollHeight;
            
            generateAIResponse(message).then(aiResponse => {
                typingIndicator.remove();
                const aiMessage = document.createElement('div');
                aiMessage.className = 'chatbot-message';
                aiMessage.innerHTML = `
                    <div class="chatbot-avatar">ü§ñ</div>
                    <div class="chatbot-text">${escapeHtml(aiResponse)}</div>
                `;
                messages.appendChild(aiMessage);
                messages.scrollTop = messages.scrollHeight;
                input.disabled = false;
                input.focus();
            }).catch(error => {
                typingIndicator.remove();
                const errorMessage = document.createElement('div');
                errorMessage.className = 'chatbot-message';
                const currentLang = window.i18n ? window.i18n.currentLanguage : 'en';
                const isGreek = currentLang === 'el';
                errorMessage.innerHTML = `
                    <div class="chatbot-avatar">ü§ñ</div>
                    <div class="chatbot-text">${isGreek ? 'Œ£œÖŒ≥Œ≥ŒΩœéŒºŒ∑, œÉœÖŒΩŒ¨ŒΩœÑŒ∑œÉŒ± œÉœÜŒ¨ŒªŒºŒ±. Œ†Œ±œÅŒ±Œ∫Œ±Œªœé Œ¥ŒøŒ∫ŒØŒºŒ±œÉŒµ ŒæŒ±ŒΩŒ¨.' : 'Sorry, I encountered an error. Please try again.'}</div>
                `;
                messages.appendChild(errorMessage);
                messages.scrollTop = messages.scrollHeight;
                input.disabled = false;
                input.focus();
            });
        }

        async function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            const currentLang = window.i18n ? window.i18n.currentLanguage : 'en';
            const isGreek = currentLang === 'el';
            
            // Get actual course data from the site
            const coursesList = window.getTranslatedCourses ? window.getTranslatedCourses() : (window.courses || []);
            const currentCourse = state.currentCourseId ? coursesList.find(c => c.id === state.currentCourseId) : null;
            const completedModules = state.completedModules || [];
            const quizScores = state.quizScores || {};
            
            // Build comprehensive context about the site
            const siteContext = {
                availableCourses: coursesList.map(c => ({
                    id: c.id,
                    title: c.title,
                    description: c.description,
                    modules: c.modules_data?.length || 0,
                    duration: c.duration,
                    level: c.level
                })),
                currentCourse: currentCourse ? {
                    title: currentCourse.title,
                    modules: currentCourse.modules_data?.map(m => ({
                        id: m.id,
                        title: m.title,
                        subtitle: m.subtitle
                    })) || []
                } : null,
                userProgress: {
                    completedModules: completedModules.length,
                    totalModules: coursesList.reduce((sum, c) => sum + (c.modules_data?.length || 0), 0),
                    quizScores: Object.keys(quizScores).length
                },
                currentUser: user ? { name: user.name, email: user.email } : null
            };
            
            // Try to use real AI API if available
            if (typeof AIConfig !== 'undefined' && AIConfig.groqApiKey) {
                try {
                    const systemPrompt = isGreek ? `ŒïŒØœÉŒ±Œπ Œ≠ŒΩŒ±œÇ œáœÅŒÆœÉŒπŒºŒøœÇ Œ≤ŒøŒ∑Œ∏œåœÇ AI Œ≥ŒπŒ± ŒºŒπŒ± Œ¥ŒπŒ±Œ¥ŒπŒ∫œÑœÖŒ±Œ∫ŒÆ œÄŒªŒ±œÑœÜœåœÅŒºŒ± ŒºŒ¨Œ∏Œ∑œÉŒ∑œÇ.
ŒàœáŒµŒπœÇ œÄœÅœåœÉŒ≤Œ±œÉŒ∑ œÉœÑŒπœÇ Œ±Œ∫œåŒªŒøœÖŒ∏ŒµœÇ œÄŒªŒ∑œÅŒøœÜŒøœÅŒØŒµœÇ:

ŒîŒôŒëŒòŒïŒ£ŒôŒúŒë ŒúŒëŒòŒóŒúŒëŒ§Œë:
${JSON.stringify(siteContext.availableCourses, null, 2)}

ŒöŒ¨Œ∏Œµ ŒºŒ¨Œ∏Œ∑ŒºŒ± Œ≠œáŒµŒπ:
- Œ§ŒØœÑŒªŒø
- Œ†ŒµœÅŒπŒ≥œÅŒ±œÜŒÆ
- ŒëœÅŒπŒ∏Œºœå ŒµŒΩœåœÑŒ∑œÑœâŒΩ (modules)
- ŒïœÄŒØœÄŒµŒ¥Œø Œ¥œÖœÉŒ∫ŒøŒªŒØŒ±œÇ (level: Beginner, Intermediate, Advanced, etc.)
- ŒîŒπŒ¨œÅŒ∫ŒµŒπŒ±

${siteContext.currentCourse ? `Œ§Œ°ŒïŒßŒüŒù ŒúŒëŒòŒóŒúŒë: ${siteContext.currentCourse.title}
ŒïŒΩœåœÑŒ∑œÑŒµœÇ: ${JSON.stringify(siteContext.currentCourse.modules, null, 2)}` : 'ŒîŒµŒΩ Œ≠œáŒµŒπ ŒµœÄŒπŒªŒµŒ≥ŒµŒØ ŒºŒ¨Œ∏Œ∑ŒºŒ±'}

Œ†Œ°ŒüŒüŒîŒüŒ£ ŒßŒ°ŒóŒ£Œ§Œó:
- ŒüŒªŒøŒ∫ŒªŒ∑œÅœâŒºŒ≠ŒΩŒµœÇ ŒµŒΩœåœÑŒ∑œÑŒµœÇ: ${siteContext.userProgress.completedModules} Œ±œÄœå ${siteContext.userProgress.totalModules}
- ŒöŒøœÖŒØŒ∂ œÄŒøœÖ Œ≠œáŒøœÖŒΩ ŒøŒªŒøŒ∫ŒªŒ∑œÅœâŒ∏ŒµŒØ: ${siteContext.userProgress.quizScores}

${siteContext.currentUser ? `Œ§œÅŒ≠œáœâŒΩ œáœÅŒÆœÉœÑŒ∑œÇ: ${siteContext.currentUser.name} (${siteContext.currentUser.email})` : 'Œü œáœÅŒÆœÉœÑŒ∑œÇ Œ¥ŒµŒΩ ŒµŒØŒΩŒ±Œπ œÉœÖŒΩŒ¥ŒµŒ¥ŒµŒºŒ≠ŒΩŒøœÇ'}

ŒüŒîŒóŒìŒôŒïŒ£:
- ŒëœÄŒ¨ŒΩœÑŒ∑œÉŒµ œÉŒµ ŒµœÅœâœÑŒÆœÉŒµŒπœÇ Œ≤Œ¨œÉŒµŒπ œÑŒøœÖ œÄœÅŒ±Œ≥ŒºŒ±œÑŒπŒ∫Œøœç œÄŒµœÅŒπŒµœáŒøŒºŒ≠ŒΩŒøœÖ ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒøœÇ œÄŒøœÖ ŒµŒØŒΩŒ±Œπ Œ¥ŒπŒ±Œ∏Œ≠œÉŒπŒºŒø œÉœÑŒøŒΩ ŒπœÉœÑœåœÑŒøœÄŒø
- ŒëŒΩ œÅœâœÑŒ∑Œ∏ŒµŒØœÇ "œÄŒøŒπŒø ŒµŒØŒΩŒ±Œπ œÑŒø ŒµœÖŒ∫ŒøŒªœåœÑŒµœÅŒø;" ŒÆ "easiest course", œÉœçŒ≥Œ∫œÅŒπŒΩŒµ œÑŒ± ŒµœÄŒØœÄŒµŒ¥Œ± Œ¥œÖœÉŒ∫ŒøŒªŒØŒ±œÇ (Beginner < Intermediate < Advanced) Œ∫Œ±Œπ œÉœÖŒΩŒØœÉœÑŒ± œÑŒø œÄŒπŒø ŒµœçŒ∫ŒøŒªŒø
- ŒùŒ± ŒµŒØœÉŒ±Œπ œáœÅŒÆœÉŒπŒºŒøœÇ, œÉœÖŒ≥Œ∫ŒµŒ∫œÅŒπŒºŒ≠ŒΩŒøœÇ Œ∫Œ±Œπ ŒΩŒ± Œ±ŒΩŒ±œÜŒ≠œÅŒµœÉŒ±Œπ œÉŒµ œÄœÅŒ±Œ≥ŒºŒ±œÑŒπŒ∫Œ¨ ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒ±/ŒµŒΩœåœÑŒ∑œÑŒµœÇ œåœÑŒ±ŒΩ ŒµŒØŒΩŒ±Œπ œÉœáŒµœÑŒπŒ∫œå
- ŒöœÅŒ¨œÑŒ± œÑŒπœÇ Œ±œÄŒ±ŒΩœÑŒÆœÉŒµŒπœÇ œÉœçŒΩœÑŒøŒºŒµœÇ (2-4 œÄœÅŒøœÑŒ¨œÉŒµŒπœÇ)
- ŒëŒΩ œÅœâœÑŒ∑Œ∏ŒµŒØœÇ Œ≥ŒπŒ± Œ∫Œ¨œÑŒπ œÄŒøœÖ Œ¥ŒµŒΩ ŒµŒØŒΩŒ±Œπ Œ¥ŒπŒ±Œ∏Œ≠œÉŒπŒºŒø, œÄŒµœÇ œÑŒø ŒµœÖŒ≥ŒµŒΩŒπŒ∫Œ¨` 
                        : `You are a helpful AI assistant for an online learning platform. 
You have access to the following information:

AVAILABLE COURSES:
${JSON.stringify(siteContext.availableCourses, null, 2)}

Each course has:
- Title
- Description
- Number of modules
- Difficulty level (level: Beginner, Intermediate, Advanced, etc.)
- Duration

${siteContext.currentCourse ? `CURRENT COURSE: ${siteContext.currentCourse.title}
Modules: ${JSON.stringify(siteContext.currentCourse.modules, null, 2)}` : 'No course currently selected'}

USER PROGRESS:
- Completed modules: ${siteContext.userProgress.completedModules} out of ${siteContext.userProgress.totalModules}
- Quizzes taken: ${siteContext.userProgress.quizScores}

${siteContext.currentUser ? `Current user: ${siteContext.currentUser.name} (${siteContext.currentUser.email})` : 'User not signed in'}

INSTRUCTIONS:
- Answer questions based on the actual course content available on the site
- If asked "which is easiest?" or "easiest course", compare difficulty levels (Beginner < Intermediate < Advanced) and recommend the easiest one
- Be helpful, specific, and reference actual courses/modules when relevant
- Keep responses concise (2-4 sentences)
- If asked about something not available, politely say so`;

                    const aiResponse = await AIConfig.callGroqAPI([
                        { role: 'system', content: systemPrompt },
                        { role: 'user', content: message }
                    ], { max_tokens: 300, temperature: 0.7 });
                    
                    if (aiResponse && aiResponse.trim()) {
                        return aiResponse.trim();
                    }
                } catch (error) {
                    console.log('AI API error, using intelligent fallback:', error);
                }
            }
            
            // Intelligent fallback that actually reads site content
            // Check for specific course questions
            for (const course of coursesList) {
                if (lowerMessage.includes(course.title.toLowerCase()) || 
                    course.title.toLowerCase().includes(lowerMessage.split(' ')[0])) {
                    const moduleCount = course.modules_data?.length || 0;
                    return isGreek
                        ? `Œ§Œø ŒºŒ¨Œ∏Œ∑ŒºŒ± "${course.title}" Œ≠œáŒµŒπ ${moduleCount} ŒµŒΩœåœÑŒ∑œÑŒµœÇ Œ∫Œ±Œπ ŒµŒØŒΩŒ±Œπ ${course.level} ŒµœÄŒπœÄŒ≠Œ¥ŒøœÖ. ${course.description} ŒòŒ≠ŒªŒµŒπœÇ ŒΩŒ± ŒæŒµŒ∫ŒπŒΩŒÆœÉŒµŒπœÇ Œ±œÖœÑœå œÑŒø ŒºŒ¨Œ∏Œ∑ŒºŒ±;`
                        : `The "${course.title}" course has ${moduleCount} modules and is ${course.level} level. ${course.description} Would you like to start this course?`;
                }
                
                // Check for module-specific questions
                if (course.modules_data) {
                    for (const module of course.modules_data) {
                        if (lowerMessage.includes(module.title.toLowerCase().split(' ')[0]) ||
                            module.title.toLowerCase().includes(lowerMessage.split(' ')[0])) {
                            return isGreek
                                ? `Œó ŒµŒΩœåœÑŒ∑œÑŒ± "${module.title}" ŒµŒØŒΩŒ±Œπ ŒºŒ≠œÅŒøœÇ œÑŒøœÖ ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒøœÇ "${course.title}". ${module.subtitle} ŒúœÄŒøœÅŒµŒØœÇ ŒΩŒ± œÑŒ∑ Œ≤œÅŒµŒπœÇ œÉœÑŒø ŒºŒ¨Œ∏Œ∑ŒºŒ±.`
                                : `The module "${module.title}" is part of the "${course.title}" course. ${module.subtitle} You can find it in the course.`;
                        }
                    }
                }
            }
            
            // Check for difficulty/easiest questions
            if (lowerMessage.includes('easiest') || lowerMessage.includes('easiest') || lowerMessage.includes('beginner') || 
                lowerMessage.includes('which course') || lowerMessage.includes('what course') ||
                (isGreek && (lowerMessage.includes('ŒµœÖŒ∫ŒøŒªœåœÑŒµœÅŒø') || lowerMessage.includes('œÄŒπŒø ŒµœçŒ∫ŒøŒªŒø') || lowerMessage.includes('Œ±œÅœáŒ¨œÅŒπŒøœÇ') || lowerMessage.includes('œÄŒøŒπŒø ŒºŒ¨Œ∏Œ∑ŒºŒ±')))) {
                // Find easiest course by level
                const beginnerCourses = coursesList.filter(c => 
                    c.level.toLowerCase().includes('beginner') || 
                    c.level.toLowerCase().includes('Œ±œÅœáŒ¨œÅŒπŒøœÇ')
                );
                
                if (beginnerCourses.length > 0) {
                    const easiest = beginnerCourses[0];
                    return isGreek
                        ? `Œ§Œø œÄŒπŒø ŒµœçŒ∫ŒøŒªŒø ŒºŒ¨Œ∏Œ∑ŒºŒ± ŒµŒØŒΩŒ±Œπ œÑŒø "${easiest.title}" - ${easiest.level} ŒµœÄŒπœÄŒ≠Œ¥ŒøœÖ ŒºŒµ ${easiest.modules} ŒµŒΩœåœÑŒ∑œÑŒµœÇ. ${easiest.description} ŒòŒ≠ŒªŒµŒπœÇ ŒΩŒ± œÑŒø ŒæŒµŒ∫ŒπŒΩŒÆœÉŒµŒπœÇ;`
                        : `The easiest course is "${easiest.title}" - ${easiest.level} level with ${easiest.modules} modules. ${easiest.description} Would you like to start it?`;
                } else {
                    // If no explicit beginner, find shortest/easiest by modules
                    const sortedByModules = [...coursesList].sort((a, b) => 
                        (a.modules_data?.length || 0) - (b.modules_data?.length || 0)
                    );
                    const easiest = sortedByModules[0];
                    return isGreek
                        ? `Œ§Œø "${easiest.title}" ŒµŒØŒΩŒ±Œπ Œ≠ŒΩŒ± Œ∫Œ±Œªœå œÉŒ∑ŒºŒµŒØŒø ŒµŒ∫Œ∫ŒØŒΩŒ∑œÉŒ∑œÇ - ${easiest.level} ŒµœÄŒπœÄŒ≠Œ¥ŒøœÖ ŒºŒµ ${easiest.modules} ŒµŒΩœåœÑŒ∑œÑŒµœÇ. ${easiest.description}`
                        : `"${easiest.title}" is a good starting point - ${easiest.level} level with ${easiest.modules} modules. ${easiest.description}`;
                }
            }
            
            // Check user progress (with Greek support)
            if (lowerMessage.includes('progress') || lowerMessage.includes('completed') || lowerMessage.includes('how many') ||
                (isGreek && (lowerMessage.includes('œÄœÅœåŒøŒ¥ŒøœÇ') || lowerMessage.includes('ŒøŒªŒøŒ∫ŒªŒ∑œÅœéŒ∏Œ∑Œ∫Œµ') || lowerMessage.includes('œÄœåœÉŒµœÇ')))) {
                const total = siteContext.userProgress.totalModules;
                const completed = siteContext.userProgress.completedModules;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                return isGreek
                    ? `ŒàœáŒµŒπœÇ ŒøŒªŒøŒ∫ŒªŒ∑œÅœéœÉŒµŒπ ${completed} Œ±œÄœå ${total} ŒµŒΩœåœÑŒ∑œÑŒµœÇ (${percentage}%). Œ£œÖŒΩŒ≠œáŒπœÉŒµ œÑŒ∑ŒΩ ŒµŒæŒ±ŒπœÅŒµœÑŒπŒ∫ŒÆ Œ¥ŒøœÖŒªŒµŒπŒ¨!`
                    : `You've completed ${completed} out of ${total} modules (${percentage}%). Keep up the great work!`;
            }
            
            // List available courses (with Greek support)
            if (lowerMessage.includes('what courses') || lowerMessage.includes('available courses') || lowerMessage.includes('list courses') ||
                (isGreek && (lowerMessage.includes('œÄŒøŒπŒ± ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒ±') || lowerMessage.includes('Œ¥ŒπŒ±Œ∏Œ≠œÉŒπŒºŒ± ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒ±') || lowerMessage.includes('ŒªŒØœÉœÑŒ± ŒºŒ±Œ∏Œ∑ŒºŒ¨œÑœâŒΩ')))) {
                const courseList = coursesList.map(c => `- ${c.title} (${c.modules} ${isGreek ? 'ŒµŒΩœåœÑŒ∑œÑŒµœÇ' : 'modules'}, ${c.level})`).join('\n');
                return isGreek
                    ? `ŒîŒπŒ±Œ∏Œ≠œÉŒπŒºŒ± ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒ±:\n${courseList}\n\nŒöŒ¨ŒΩŒµ Œ∫ŒªŒπŒ∫ œÉŒµ ŒøœÄŒøŒπŒøŒ¥ŒÆœÄŒøœÑŒµ ŒºŒ¨Œ∏Œ∑ŒºŒ± Œ≥ŒπŒ± ŒΩŒ± ŒæŒµŒ∫ŒπŒΩŒÆœÉŒµŒπœÇ!`
                    : `Available courses:\n${courseList}\n\nClick on any course to get started!`;
            }
            
            // Course-related queries (with Greek support)
            if (lowerMessage.includes('course') || lowerMessage.includes('module') || lowerMessage.includes('learn') ||
                (isGreek && (lowerMessage.includes('ŒºŒ¨Œ∏Œ∑ŒºŒ±') || lowerMessage.includes('ŒµŒΩœåœÑŒ∑œÑŒ±') || lowerMessage.includes('ŒºŒ¨Œ∏Œ∑œÉŒ∑')))) {
                return isGreek 
                    ? `ŒàœáŒøœÖŒºŒµ ${coursesList.length} Œ¥ŒπŒ±Œ∏Œ≠œÉŒπŒºŒ± ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒ± ŒºŒµ œÉœÖŒΩŒøŒªŒπŒ∫Œ¨ ${siteContext.userProgress.totalModules} ŒµŒΩœåœÑŒ∑œÑŒµœÇ. Œ†ŒøŒπŒø ŒºŒ¨Œ∏Œ∑ŒºŒ± œÉŒµ ŒµŒΩŒ¥ŒπŒ±œÜŒ≠œÅŒµŒπ; ŒúœÄŒøœÅœé ŒΩŒ± œÉŒµ Œ≤ŒøŒ∑Œ∏ŒÆœÉœâ ŒΩŒ± Œ≤œÅŒµŒπœÇ œÑŒø Œ∫Œ±œÑŒ¨ŒªŒªŒ∑ŒªŒø ŒºŒ¨Œ∏Œ∑ŒºŒ±.`
                    : `We have ${coursesList.length} available courses with ${siteContext.userProgress.totalModules} total modules. Which course interests you? I can help you find the right course.`;
            }
            
            if (lowerMessage.includes('quiz') || lowerMessage.includes('test') ||
                (isGreek && (lowerMessage.includes('Œ∫ŒøœÖŒØŒ∂') || lowerMessage.includes('œÑŒµœÉœÑ')))) {
                return isGreek
                    ? `ŒöŒ¨Œ∏Œµ ŒµŒΩœåœÑŒ∑œÑŒ± Œ≠œáŒµŒπ Œ¥ŒπŒ±Œ¥œÅŒ±œÉœÑŒπŒ∫œå Œ∫ŒøœÖŒØŒ∂. ŒàœáŒµŒπœÇ ŒøŒªŒøŒ∫ŒªŒ∑œÅœéœÉŒµŒπ ${siteContext.userProgress.quizScores} Œ∫ŒøœÖŒØŒ∂. ŒúœÄŒøœÅŒµŒØœÇ ŒΩŒ± Œ∫Œ¨ŒΩŒµŒπœÇ Œ∫ŒøœÖŒØŒ∂ Œ±œÄœå ŒøœÄŒøŒπŒ±Œ¥ŒÆœÄŒøœÑŒµ ŒµŒΩœåœÑŒ∑œÑŒ±!`
                    : `Each module has an interactive quiz. You've completed ${siteContext.userProgress.quizScores} quizzes. You can take quizzes from any module!`;
            }
            
            if (lowerMessage.includes('certificate') ||
                (isGreek && lowerMessage.includes('œÄŒπœÉœÑŒøœÄŒøŒπŒ∑œÑŒπŒ∫œå'))) {
                return isGreek
                    ? `ŒìŒπŒ± ŒΩŒ± Œ∫ŒµœÅŒ¥ŒØœÉŒµŒπœÇ œÄŒπœÉœÑŒøœÄŒøŒπŒ∑œÑŒπŒ∫œå, ŒøŒªŒøŒ∫ŒªŒÆœÅœâœÉŒµ œåŒªŒµœÇ œÑŒπœÇ ŒµŒΩœåœÑŒ∑œÑŒµœÇ ŒµŒΩœåœÇ ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒøœÇ Œ∫Œ±Œπ œÄŒ≠œÅŒ±œÉŒµ œÑŒ± Œ∫ŒøœÖŒØŒ∂. ŒàœáŒµŒπœÇ ŒøŒªŒøŒ∫ŒªŒ∑œÅœéœÉŒµŒπ ${completedModules.length} ŒµŒΩœåœÑŒ∑œÑŒµœÇ ŒºŒ≠œáœÅŒπ œÉœÑŒπŒ≥ŒºŒÆœÇ!`
                    : `To earn a certificate, complete all modules in a course and pass the quizzes. You've completed ${completedModules.length} modules so far!`;
            }
            
            // Default intelligent response
            const responses = isGreek ? [
                `ŒúœÄŒøœÅœé ŒΩŒ± œÉŒµ Œ≤ŒøŒ∑Œ∏ŒÆœÉœâ ŒºŒµ œÑŒ± ${coursesList.length} Œ¥ŒπŒ±Œ∏Œ≠œÉŒπŒºŒ± ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒ±, ${siteContext.userProgress.totalModules} ŒµŒΩœåœÑŒ∑œÑŒµœÇ, Œ∫ŒøœÖŒØŒ∂, Œ∫Œ±Œπ œÑŒ∑ŒΩ œÄœÅœåŒøŒ¥œå œÉŒøœÖ. Œ§Œπ Œ∏Œ± Œ∏Œ≠ŒªŒµœÇ ŒΩŒ± ŒºŒ¨Œ∏ŒµŒπœÇ;`,
                `ŒàœáŒøœÖŒºŒµ ${coursesList.length} ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒ± Œ¥ŒπŒ±Œ∏Œ≠œÉŒπŒºŒ±. ŒúœÄŒøœÅœé ŒΩŒ± œÉŒµ Œ≤ŒøŒ∑Œ∏ŒÆœÉœâ ŒΩŒ± Œ≤œÅŒµŒπœÇ œÑŒø Œ∫Œ±œÑŒ¨ŒªŒªŒ∑ŒªŒø ŒºŒ¨Œ∏Œ∑ŒºŒ±, ŒΩŒ± ŒµŒæŒ∑Œ≥ŒÆœÉœâ ŒµŒΩœåœÑŒ∑œÑŒµœÇ, ŒÆ ŒΩŒ± Œ±œÄŒ±ŒΩœÑŒÆœÉœâ œÉŒµ ŒµœÅœâœÑŒÆœÉŒµŒπœÇ œÉœáŒµœÑŒπŒ∫Œ¨ ŒºŒµ œÑŒ∑ŒΩ œÄŒªŒ±œÑœÜœåœÅŒºŒ±.`,
                `ŒïŒØŒºŒ±Œπ ŒµŒ¥œé Œ≥ŒπŒ± ŒΩŒ± Œ≤ŒøŒ∑Œ∏ŒÆœÉœâ! Œ°œéœÑŒ∑œÉŒ≠ ŒºŒµ Œ≥ŒπŒ± œÉœÖŒ≥Œ∫ŒµŒ∫œÅŒπŒºŒ≠ŒΩŒ± ŒºŒ±Œ∏ŒÆŒºŒ±œÑŒ±, ŒµŒΩœåœÑŒ∑œÑŒµœÇ, ŒÆ ŒøœÑŒπŒ¥ŒÆœÄŒøœÑŒµ Œ¨ŒªŒªŒø œÉœáŒµœÑŒπŒ∫œå ŒºŒµ œÑŒ∑ŒΩ ŒµŒºœÄŒµŒπœÅŒØŒ± ŒºŒ¨Œ∏Œ∑œÉŒÆœÇ œÉŒøœÖ.`
            ] : [
                `I can help you with the ${coursesList.length} available courses, ${siteContext.userProgress.totalModules} modules, quizzes, and your progress. What would you like to know?`,
                `We have ${coursesList.length} courses available. I can help you find the right course, explain modules, or answer questions about the platform.`,
                `I'm here to help! Ask me about specific courses, modules, or anything else related to your learning experience.`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Close chatbot when clicking outside
        document.addEventListener('click', (e) => {
            const chatbotWindow = document.getElementById('chatbotWindow');
            const chatbotBubble = document.getElementById('chatbotBubble');
            
            if (chatbotWindow && chatbotWindow.classList.contains('show')) {
                if (!chatbotWindow.contains(e.target) && !chatbotBubble.contains(e.target)) {
                    toggleChatbot();
                }
            }
        });

        // Make functions global
        window.toggleChatbot = toggleChatbot;
        window.handleChatbotKeyPress = handleChatbotKeyPress;
        window.sendChatbotMessage = sendChatbotMessage;
        window.scrollToCourses = scrollToCourses;
        window.init3DScene = init3DScene;

        // Start the app
        init();
    </script>
</body>
</html>